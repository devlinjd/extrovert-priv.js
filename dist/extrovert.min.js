/*! extrovert 27-03-2015 */
var EXTROVERT=function(a,b){function c(a){return A.log=C.log,A.generator=a.generator?"string"==typeof a.generator?new EXTROVERT[a.generator]:new EXTROVERT[a.generator.name]:new EXTROVERT["float"],B=C.extend(!0,{},z,A.generator.options),B=C.extend(!0,B,a),B.physics.enabled&&(Physijs.scripts.worker=B.physics.physijs.worker,Physijs.scripts.ammo=B.physics.physijs.ammo),A.rasterizer="string"==typeof B.rasterizer?new EXTROVERT["paint_"+B.rasterizer]:B.rasterizer||new EXTROVERT.paint_img,B}function d(a,b){b.drag_plane=EXTROVERT.create_object({type:"plane",dims:[2e3,2e3,8],visible:!1,color:0,opacity:.25,transparent:!0}),EXTROVERT.create_scene(a),EXTROVERT.create_camera(C.extend(!0,{},a.camera,b.generator.init_cam_opts)),EXTROVERT.fiat_lux(a.lights),b.generator.init&&b.generator.init(a,b),h(b.scene,a),b.scene.updateMatrix();var c,d=document.querySelectorAll(a.src.selector),e=d.length;for(c=0;e>c;++c){var f=d[c],g=b.generator.generate(f);g.updateMatrix(),g.updateMatrixWorld(),a.creating&&a.creating(f,g),b.scene.add(g),b.objects.push(g),g.elem=f,a.created&&a.created(f,g)}var i=a.camera;i.rotation&&b.camera.rotation.set(i.rotation[0],i.rotation[1],i.rotation[2]),i.position&&b.camera.position.set(i.position[0],i.position[1],i.position[2])}function e(a,b){return b.controls=y.create_controls(a.controls,b.camera,b.renderer.domElement),b.controls}function f(c){var d=C.$(c.src.container),e=d.getBoundingClientRect();A.width=e.right-e.left,A.height=e.bottom-e.top,A.renderer=new b.WebGLRenderer({antialias:!0}),A.renderer.setPixelRatio(a.devicePixelRatio),A.renderer.setSize(A.width,A.height),c.bkcolor&&A.renderer.setClearColor(c.bkcolor),A.renderer.domElement.setAttribute("tabindex","0"),A.renderer.domElement.style+=" position: relative;",A.renderer.autoClearStencil=!1,A.renderer.getContext().clearStencil=function(){}}function g(a){var b=a.target.action||"append",c=C.$(a.target.container);"append"===b?c.appendChild(A.renderer.domElement):("replace"===b||"replaceWith"===b)&&(c.parentNode.insertBefore(A.renderer.domElement,c),c.parentNode.removeChild(c))}function h(a,b){if(b.scene&&b.scene.items)for(var c=0;c<b.scene.items.length;c++){var d=y.create_object(b.scene.items[c]);a.add(d)}}function i(a,b,c,d,e,f){a.moveTo(b,c+f),a.lineTo(b,c+e-f),a.quadraticCurveTo(b,c+e,b+f,c+e),a.lineTo(b+d-f,c+e),a.quadraticCurveTo(b+d,c+e,b+d,c+e-f),a.lineTo(b+d,c+f),a.quadraticCurveTo(b+d,c,b+d-f,c),a.lineTo(b+f,c),a.quadraticCurveTo(b,c,b,c+f)}function j(a,c,d,e,f){return B.physics.enabled&&!e?new Physijs[c+"Mesh"](a,d,f):new b.Mesh(a,d)}function k(a){a.physics.enabled&&(A.gravity.set(a.gravity[0],a.gravity[1],a.gravity[2]),A.scene.setGravity(A.gravity),A.scene.addEventListener("update",p))}function l(){A.renderer.domElement.addEventListener("mousedown",t,!1),A.renderer.domElement.addEventListener("mouseup",v,!1),A.renderer.domElement.addEventListener("mousemove",u,!1),a.addEventListener("resize",w,!1)}function m(){A.start_time=A.last_time=Date.now()/1e3}function n(){B.onload&&B.onload(),o()}function o(){requestAnimationFrame(o),q()}function p(){}function q(){B.physics.enabled&&A.scene.simulate();{var a=Date.now()/1e3;a-A.last_time}if(A.last_time=a,!B.move_with_physics){null!==A.selected&&(A.selected.__dirtyPosition=!0);for(var b=0,c=A.objects.length;c>b;b++)A.objects[b].has_been_touched&&(A.objects[b].__dirtyPosition=!0)}A.controls&&A.controls.enabled&&A.controls.update(),A.renderer.clear(),A.renderer.render(A.scene,A.camera)}function r(a){var c=new b.SpotLight(a.color);return c.shadowCameraVisible=!1,c}function s(a){if(B.physics.enabled){var c=(new b.Matrix4).extractRotation(a.object.matrix),d=a.face.normal.clone().negate().multiplyScalar(B.click_force).applyMatrix4(c),e=a.point.clone().sub(a.object.position);a.object.applyImpulse(d,e)}}function t(a){a.preventDefault();var b=void 0===a.offsetX?a.layerX:a.offsetX,c=void 0===a.offsetY?a.layerY:a.offsetY;A.mouse=x(b,c,.5,A.mouse),A.raycaster.setFromCamera(A.mouse,A.camera);var d=A.raycaster.intersectObjects(A.objects);0!==d.length&&(a.ctrlKey?(A.selected=d[0].object,A.selected.has_been_touched=!0,A.drag_plane.position.copy(A.selected.position),A.offset.copy(d[0].point).sub(A.selected.position),B.physics.enabled?(A.selected.setAngularFactor(C.VZERO),A.selected.setLinearFactor(C.VZERO),A.selected.setAngularVelocity(C.VZERO),A.selected.setLinearVelocity(C.VZERO)):(A.selected.temp_velocity=A.selected.velocity.clone(),A.selected.velocity.set(0,0,0))):s(d[0])),A.controls&&A.controls.enabled&&(A.controls.mousedown(a),A.pass_mouse_input=!0)}function u(a){if(A.pass_mouse_input&&A.controls&&A.controls.enabled)return void A.controls.mousemove(a);a.preventDefault();var b=void 0===a.offsetX?a.layerX:a.offsetX,c=void 0===a.offsetY?a.layerY:a.offsetY;if(A.mouse=x(b,c,.5,A.mouse),A.selected){A.raycaster.setFromCamera(A.mouse,A.camera);var d=A.raycaster.intersectObject(A.drag_plane);if(B.move_with_physics){var e=d[0].point.sub(A.selected.position);e.z=0,A.selected.setLinearVelocity(e)}else A.selected.position.copy(d[0].point.sub(A.offset)),A.selected.__dirtyPosition=!0}}function v(a){if(A.pass_mouse_input&&A.controls&&A.controls.enabled)return A.controls.mouseup(a),void(A.pass_mouse_input=!1);if(a.preventDefault(),A.selected&&B.physics.enabled){if(B.physics.enabled){var c=new b.Vector3(1,1,1);A.selected.setAngularFactor(c),A.selected.setLinearFactor(c),A.selected.__dirtyPosition=!0}else{A.raycaster.setFromCamera(A.mouse,A.camera);var d=A.raycaster.intersectObject(A.drag_plane);A.selected.position.copy(d[0].point.sub(A.offset))}A.selected.updateMatrixWorld(),A.selected.updateMatrix()}A.selected=null}function w(){var a=A.renderer.domElement.parentNode.getBoundingClientRect();A.width=a.right-a.left,A.height=a.bottom-a.top,A.camera.aspect=A.width/A.height,A.camera.updateProjectionMatrix(),A.renderer.setSize(A.width,A.height)}function x(a,b,c,d){return d.x=a/A.width*2-1,d.y=2*-(b/A.height)+1,d.z=c,d}var y={},z={src:{selector:"div",title:"h2",container:"#container"},generator:"gallery",rasterizer:"img",gravity:[0,0,0],camera:{fov:35,near:1,far:2e3},physics:{enabled:!0,materials:!1,physijs:{worker:"physijs_worker.js",ammo:"ammo.js"}},block:{width:128,height:64,depth:2},move_with_physics:!0,click_force:3e4,onload:null,onerror:null},A={camera:null,scene:null,renderer:null,raycaster:new b.Raycaster,mouse:new b.Vector2,width:100,height:100,gravity:new b.Vector3(z.gravity[0],z.gravity[1],z.gravity[2]),selected:null,start_time:0,last_time:0,objects:[],drag_plane:null,placement_plane:null,offset:new b.Vector3,generator:null,clock:new b.Clock},B=null,C=null;return y.init=function(h){if(C=EXTROVERT.Utils,!C.detect_webgl())return!1;var i=a.navigator.userAgent;return(~i.indexOf("MSIE ")||~i.indexOf("Trident/"))&&Object.keys(b.ShaderLib).forEach(function(a){b.ShaderLib[a].fragmentShader=b.ShaderLib[a].fragmentShader.replace("#extension GL_EXT_frag_depth : enable","")}),c(h),f(B),d(B,A),g(B),k(B),e(B,A),l(),m(),n(),!0},y.create_controls=function(a,c,d){var e=null;if(a&&a.type&&"trackball"!==a.type)"fly"===a.type;else{var f={ignore_events:"mousedown mousemove mouseup"};a&&a.target&&(f.target=a.target),e=new b.TrackballControls(c,d,f),e.rotateSpeed=1,e.zoomSpeed=1.2,e.panSpeed=.8,e.noZoom=!1,e.noPan=!1,e.staticMoving=!0,e.dynamicDampingFactor=.3,e.keys=[65,83,68]}return e},y.create_camera=function(a){var c="orthographic"!=a.type?new b.PerspectiveCamera(a.fov,A.width/A.height,a.near,a.far):new b.OrthographicCamera(a.left,a.right,a.top,a.bottom,a.near,a.far);return c.position.set(a.position[0],a.position[1],a.position[2]),A.camera=c,a.up&&c.up.set(a.up[0],a.up[1],a.up[2]),a.lookat&&c.lookAt(new b.Vector3(a.lookat[0],a.lookat[1],a.lookat[2])),c.updateMatrix(),c.updateMatrixWorld(),c.updateProjectionMatrix(),c},y.create_scene=function(a){var c=a.physics.enabled?new Physijs.Scene:new b.Scene;return A.scene=c,c},y.create_object=function(a){var c=null,d=null,e=null,f=a.color||16777215,g=a.opacity||1,h=a.transparent||!0;if("box"===a.type)d=new b.BoxGeometry(a.dims[0],a.dims[1],a.dims[2]),e=a.mat||new b.MeshLambertMaterial({color:f,opacity:g,transparent:h}),c=j(d,"Box",e,!1,a.mass);else if("plane"===a.type)d=new b.PlaneBufferGeometry(a.dims[0],a.dims[1]),e=a.mat||new b.MeshBasicMaterial({color:f,opacity:g,transparent:h}),c=j(d,null,e,!0,a.mass);else if("roundedrect"==a.type){var k=new b.Shape;i(k,0,0,a.dims[0],a.dims[1],a.radius||20);var l=k.extrude({amount:8,bevelEnabled:!0,bevelSegments:2,steps:2,bevelSize:1,bevelThickness:1,material:0,extrudeMaterial:1}),m=a.mat?a.mat:new b.MeshLambertMaterial({color:f,opacity:g,transparent:h});e=new b.MeshFaceMaterial([m,m]),c=j(l,"Convex",e,!0,a.mass)}return a.pos&&c.position.set(a.pos[0],a.pos[1],a.pos[2]),a.visible===!1&&(c.visible=!1),c.castShadow=c.receiveShadow=!1,c},y.fiat_lux=function(a){var c=[],d=null;if(a&&0!==a.length){for(var e=0;e<a.length;e++){var f=a[e];if("ambient"===f.type)d=new b.AmbientLight(f.color);else if("point"===f.type)d=new b.PointLight(f.color,f.intensity,f.distance);else{if("spotlight"!==f.type)return;d=r(f)}"ambient"!==f.type&&(f.pos?d.position.set(f.pos[0],f.pos[1],f.pos[2]):d.position.copy(A.camera.position)),A.scene.add(d),c.push(d)}return c}},y.calc_position=function(a,c){A.raycaster.setFromCamera(x(a,c,.5,new b.Vector3),A.camera);var d=A.raycaster.intersectObject(A.placement_plane);return d.length>0?d[0].point:null},y.get_position=function(a,b,c){var d=C.offset(C.$(b.src.container)),e=C.offset(a),f={left:e.left-d.left,top:e.top-d.top},g=EXTROVERT.calc_position(f.left,f.top,c.placement_plane),h=EXTROVERT.calc_position(f.left+a.offsetWidth,f.top+a.offsetHeight,c.placement_plane),i=Math.abs(h.x-g.x),j=Math.abs(g.y-h.y);return{pos:[g.x+i/2,g.y-j/2,g.z-b.block.depth/2],width:i,height:j,depth:b.block.depth}},y.create_placement_plane=function(a,c){c=c||[2e5,2e5,1];var d=new b.BoxGeometry(c[0],c[1],c[2]);return A.placement_plane=B.physics.enabled?new Physijs.BoxMesh(d,new b.MeshBasicMaterial({color:11215651,opacity:1,transparent:!1}),0):new b.Mesh(d,new b.MeshBasicMaterial({color:11215651,opacity:1,transparent:!1})),A.placement_plane.visible=!1,a&&A.placement_plane.position.set(a[0],a[1],a[2]),A.scene.updateMatrix(),A.placement_plane.updateMatrix(),A.placement_plane.updateMatrixWorld(),A.placement_plane},y}(window,THREE);THREE.TrackballControls=function(a,b,c){function d(a,b,c){c&&c.ignore_events&&-1!==c.ignore_events.indexOf(a)||k.domElement.addEventListener(a,b,!1)}function e(a){k.enabled!==!1&&(window.removeEventListener("keydown",e),p=o,a.keyCode!==k.keys[l.ROTATE]||k.noRotate?a.keyCode!==k.keys[l.ZOOM]||k.noZoom?a.keyCode!==k.keys[l.PAN]||k.noPan||(o=l.PAN):o=l.ZOOM:o=l.ROTATE)}function f(){k.enabled!==!1&&window.addEventListener("keydown",e,!1)}function g(a){if(k.enabled!==!1){a.preventDefault(),a.stopPropagation();var b=0;a.wheelDelta?b=a.wheelDelta/40:a.detail&&(b=-a.detail/3),v.y+=.01*b,k.dispatchEvent(C),k.dispatchEvent(D)}}function h(a){if(k.enabled!==!1){switch(a.touches.length){case 1:o=l.TOUCH_ROTATE,s.copy(F(a.touches[0].pageX,a.touches[0].pageY)),r.copy(s);break;case 2:o=l.TOUCH_ZOOM_PAN;var b=a.touches[0].pageX-a.touches[1].pageX,c=a.touches[0].pageY-a.touches[1].pageY;y=x=Math.sqrt(b*b+c*c);var d=(a.touches[0].pageX+a.touches[1].pageX)/2,e=(a.touches[0].pageY+a.touches[1].pageY)/2;z.copy(E(d,e)),A.copy(z);break;default:o=l.NONE}k.dispatchEvent(C)}}function i(a){if(k.enabled!==!1)switch(a.preventDefault(),a.stopPropagation(),a.touches.length){case 1:r.copy(s),s.copy(F(a.touches[0].pageX,a.touches[0].pageY));break;case 2:var b=a.touches[0].pageX-a.touches[1].pageX,c=a.touches[0].pageY-a.touches[1].pageY;y=Math.sqrt(b*b+c*c);var d=(a.touches[0].pageX+a.touches[1].pageX)/2,e=(a.touches[0].pageY+a.touches[1].pageY)/2;A.copy(E(d,e));break;default:o=l.NONE}}function j(a){if(k.enabled!==!1){switch(a.touches.length){case 1:r.copy(s),s.copy(F(a.touches[0].pageX,a.touches[0].pageY));break;case 2:x=y=0;var b=(a.touches[0].pageX+a.touches[1].pageX)/2,c=(a.touches[0].pageY+a.touches[1].pageY)/2;A.copy(E(b,c)),z.copy(A)}o=l.NONE,k.dispatchEvent(D)}}var k=this,l={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4};this.object=a,this.domElement=void 0!==b?b:document,this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.keys=[65,83,68],this.target=new THREE.Vector3,c.target&&this.target.set(c.target[0],c.target[1],c.target[2]);var m=1e-6,n=new THREE.Vector3,o=l.NONE,p=l.NONE,q=new THREE.Vector3,r=new THREE.Vector2,s=new THREE.Vector2,t=new THREE.Vector3,u=0,v=new THREE.Vector2,w=new THREE.Vector2,x=0,y=0,z=new THREE.Vector2,A=new THREE.Vector2;this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone();var B={type:"change"},C={type:"start"},D={type:"end"};this.handleResize=function(){if(k.domElement===document)this.screen.left=0,this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight;else{var a=this.domElement.getBoundingClientRect(),b=k.domElement.ownerDocument.documentElement;this.screen.left=a.left+window.pageXOffset-b.clientLeft,this.screen.top=a.top+window.pageYOffset-b.clientTop,this.screen.width=a.width,this.screen.height=a.height}};var E=function(){var a=new THREE.Vector2;return function(b,c){return a.set((b-k.screen.left)/k.screen.width,(c-k.screen.top)/k.screen.height),a}}(),F=function(){var a=new THREE.Vector2;return function(b,c){return a.set((b-.5*k.screen.width-k.screen.left)/(.5*k.screen.width),(k.screen.height+2*(k.screen.top-c))/k.screen.width),a}}();this.rotateCamera=function(){var a,b=new THREE.Vector3,c=new THREE.Quaternion,d=new THREE.Vector3,e=new THREE.Vector3,f=new THREE.Vector3,g=new THREE.Vector3;return function(){g.set(s.x-r.x,s.y-r.y,0),a=g.length(),a?(q.copy(k.object.position).sub(k.target),d.copy(q).normalize(),e.copy(k.object.up).normalize(),f.crossVectors(e,d).normalize(),e.setLength(s.y-r.y),f.setLength(s.x-r.x),g.copy(e.add(f)),b.crossVectors(g,q).normalize(),a*=k.rotateSpeed,c.setFromAxisAngle(b,a),q.applyQuaternion(c),k.object.up.applyQuaternion(c),t.copy(b),u=a):!k.staticMoving&&u&&(u*=Math.sqrt(1-k.dynamicDampingFactor),q.copy(k.object.position).sub(k.target),c.setFromAxisAngle(t,u),q.applyQuaternion(c),k.object.up.applyQuaternion(c)),r.copy(s)}}(),this.zoomCamera=function(){var a;o===l.TOUCH_ZOOM_PAN?(a=x/y,x=y,q.multiplyScalar(a)):(a=1+(w.y-v.y)*k.zoomSpeed,1!==a&&a>0&&(q.multiplyScalar(a),k.staticMoving?v.copy(w):v.y+=(w.y-v.y)*this.dynamicDampingFactor))},this.panCamera=function(){var a=new THREE.Vector2,b=new THREE.Vector3,c=new THREE.Vector3;return function(){a.copy(A).sub(z),a.lengthSq()&&(a.multiplyScalar(q.length()*k.panSpeed),c.copy(q).cross(k.object.up).setLength(a.x),c.add(b.copy(k.object.up).setLength(a.y)),k.object.position.add(c),k.target.add(c),k.staticMoving?z.copy(A):z.add(a.subVectors(A,z).multiplyScalar(k.dynamicDampingFactor)))}}(),this.checkDistances=function(){k.noZoom&&k.noPan||(q.lengthSq()>k.maxDistance*k.maxDistance&&k.object.position.addVectors(k.target,q.setLength(k.maxDistance)),q.lengthSq()<k.minDistance*k.minDistance&&k.object.position.addVectors(k.target,q.setLength(k.minDistance)))},this.update=function(){q.subVectors(k.object.position,k.target),k.noRotate||k.rotateCamera(),k.noZoom||k.zoomCamera(),k.noPan||k.panCamera(),k.object.position.addVectors(k.target,q),k.checkDistances(),k.object.lookAt(k.target),n.distanceToSquared(k.object.position)>m&&(k.dispatchEvent(B),n.copy(k.object.position))},this.reset=function(){o=l.NONE,p=l.NONE,k.target.copy(k.target0),k.object.position.copy(k.position0),k.object.up.copy(k.up0),q.subVectors(k.object.position,k.target),k.object.lookAt(k.target),k.dispatchEvent(B),n.copy(k.object.position)},this.mousedown=function(a){k.enabled!==!1&&(a.preventDefault(),a.stopPropagation(),o===l.NONE&&(o=l.PAN),o!==l.ROTATE||k.noRotate?o!==l.ZOOM||k.noZoom?o!==l.PAN||k.noPan||(z.copy(E(a.pageX,a.pageY)),A.copy(z)):(v.copy(E(a.pageX,a.pageY)),w.copy(v)):(s.copy(F(a.pageX,a.pageY)),r.copy(s)),k.dispatchEvent(C))},this.mousemove=function(a){k.enabled!==!1&&o!==l.NONE&&(a.preventDefault(),a.stopPropagation(),o!==l.ROTATE||k.noRotate?o!==l.ZOOM||k.noZoom?o!==l.PAN||k.noPan||A.copy(E(a.pageX,a.pageY)):w.copy(E(a.pageX,a.pageY)):(r.copy(s),s.copy(F(a.pageX,a.pageY))))},this.mouseup=function(a){k.enabled!==!1&&(a.preventDefault(),a.stopPropagation(),k.dispatchEvent(D))},d("mousedown",this.mousedown,c),d("mousewheel",g,c),d("DOMMouseScroll",g,c),d("touchstart",h,c),d("touchend",j,c),d("touchmove",i,c),window.addEventListener("keydown",e,!1),window.addEventListener("keyup",f,!1),this.handleResize(),this.update()},THREE.TrackballControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.TrackballControls.prototype.constructor=THREE.TrackballControls,EXTROVERT.Utils=function(a,b){var c={};return c.VZERO=new b.Vector3(0,0,0),c.shade_blend=function(a,b,c){var d=0>a?-1*a:a,e=Math.round,f=parseInt;if(b.length>7){var g=b.split(","),h=(c?c:0>a?"rgb(0,0,0)":"rgb(255,255,255)").split(","),i=f(g[0].slice(4)),j=f(g[1]),k=f(g[2]);return"rgb("+(e((f(h[0].slice(4))-i)*d)+i)+","+(e((f(h[1])-j)*d)+j)+","+(e((f(h[2])-k)*d)+k)+")"}var g=f(b.slice(1),16),h=f((c?c:0>a?"#000000":"#FFFFFF").slice(1),16),l=g>>16,m=g>>8&255,n=255&g;return"#"+(16777216+65536*(e(((h>>16)-l)*d)+l)+256*(e(((h>>8&255)-m)*d)+m)+(e(((255&h)-n)*d)+n)).toString(16).slice(1)},c.wrap_text=function(a,b,c,d,e,f,g){for(var h=1,i=!0,j=b.split("\n"),k="",l="",m=0;m<j.length;m++){var n=j[m].split(" ");i=!0,k="";for(var o=0;o<n.length;o++){l=k+(i?"":" ")+n[o];var p=a.measureText(l);p.width<=e?(i=!1,k=l):(g||a.fillText(k,c,d),i=!0,d+=f,h++,k=n[o],p=a.measureText(k),p.width<=e&&(i=!1))}g||a.fillText(k,c,d),d+=f}return h},c.detect_webgl=function(b){if(a.WebGLRenderingContext){for(var c=document.createElement("canvas"),d=["webgl","experimental-webgl","moz-webgl","webkit-3d"],e=!1,f=0;4>f;f++)try{if(e=c.getContext(d[f]),e&&"function"==typeof e.getParameter)return b?{name:d[f],gl:e}:!0}catch(g){}return!1}return!1},c.calc_frustum=function(a){var c=2*Math.tan(a.fov*Math.PI/180/2)*a.near,d=c*a.aspect,e=2*Math.tan(a.fov*Math.PI/180/2)*a.far,f=e*a.aspect,g=a.position.z-a.near,h=a.position.z-a.far;return{nearPlane:{topLeft:new b.Vector3(-(d/2),c/2,g),topRight:new b.Vector3(d/2,c/2,g),botRight:new b.Vector3(d/2,-(c/2),g),botLeft:new b.Vector3(-(d/2),-(c/2),g)},farPlane:{topLeft:new b.Vector3(-(f/2),e/2,h),topRight:new b.Vector3(f/2,e/2,h),botRight:new b.Vector3(f/2,-(e/2),h),botLeft:new b.Vector3(-(f/2),-(e/2),h)}}},c.is_plain_object=function(a){return"object"!=typeof a||a.nodeType||null!==a&&a===a.window?!1:a.constructor&&!hasOwnProperty.call(a.constructor.prototype,"isPrototypeOf")?!1:!0},c.extend=function(){var a,b,d,e,f,g,h=arguments[0]||{},i=1,j=arguments.length,k=!1;for("boolean"==typeof h&&(k=h,h=arguments[i]||{},i++),"object"!=typeof h&&"function"!=typeof h&&(h={});j>i;i++)if(null!==(a=arguments[i]))for(b in a)d=h[b],e=a[b],h!==e&&(k&&e&&(c.is_plain_object(e)||(f=e.constructor===Array))?(f?(f=!1,g=d&&jQuery.isArray(d)?d:[]):g=d&&c.is_plain_object(d)?d:{},h[b]=c.extend(k,g,e)):void 0!==e&&(h[b]=e));return h},c.offset=function(a){var b,c,d={top:0,left:0};return doc=a&&a.ownerDocument,doc?(b=doc.documentElement,void 0!==a.getBoundingClientRect&&(d=a.getBoundingClientRect()),c=null!==doc&&doc===doc.window?doc:9===doc.nodeType&&doc.defaultView,{top:d.top+c.pageYOffset-b.clientTop,left:d.left+c.pageXOffset-b.clientLeft}):void 0},c.log=function(){return{msg:function(){var a=Array.prototype.slice.call(arguments);console.log.apply(console,a)},warn:function(){var a=Array.prototype.slice.call(arguments);console.warn.apply(console,a)},error:function(){var a=Array.prototype.slice.call(arguments);console.error.apply(console,a)}}}(),c.get_computed_style=function(a,b){var c,d=a.ownerDocument.defaultView;return d&&d.getComputedStyle?(b=b.replace(/([A-Z])/g,"-$1").toLowerCase(),d.getComputedStyle(a,null).getPropertyValue(b)):a.currentStyle?(b=b.replace(/\-(\w)/g,function(a,b){return b.toUpperCase()}),c=a.currentStyle[b],/^\d+(em|pt|%|ex)?$/i.test(c)?function(b){var c=a.style.left,d=a.runtimeStyle.left;return a.runtimeStyle.left=a.currentStyle.left,a.style.left=b||0,b=a.style.pixelLeft+"px",a.style.left=c,a.runtimeStyle.left=d,b}(c):c):void 0},c.$=function(a){var b="querySelectorAll";return 0===a.indexOf("#")&&(b="getElementById",a=a.substr(1,a.length)),document[b](a)},c}(window,THREE),function(a,b,c){function d(a,b,d){var e=c.Utils.offset(c.Utils.$(b.src.container)),f=c.Utils.offset(a),g={left:f.left-e.left,top:f.top-e.top},h=c.calc_position(g.left,g.top,d.placement_plane),i=c.calc_position(g.left+a.offsetWidth,g.top+a.offsetHeight,d.placement_plane),j=Math.abs(i.x-h.x),k=Math.abs(h.z-i.z),l=k;return{pos:[h.x+j/2,h.y-l/2,h.z+k/2],width:j,depth:k,height:l}}c.city=function(){var a=null,e=null;return{init:function(b,d){a=b,e=d;var f=c.Utils.calc_frustum(e.camera);b.scene.items[0].dims[0]=f.farPlane.topRight.x-f.farPlane.topLeft.x,b.scene.items[0].dims[2]=f.farPlane.topRight.y-f.farPlane.botRight.y,c.create_placement_plane([0,200,0],[2e5,1,2e5])},transform:function(b){return d(b,a,e)},rasterize:function(c){var d=e.rasterizer.paint(c,a),f=a.physics.enabled&&a.physics.materials?Physijs.createMaterial(d.mat,.2,1):d.mat;return new b.MeshFaceMaterial([f,f,f,f,f,f])},generate:function(d){var e=this.transform(d),f=this.rasterize(d),g=c.create_object({type:"box",pos:e.pos,dims:[e.width,e.height,e.depth],mat:f,mass:1e3});return a.generator.lookat&&g.lookAt(new b.Vector3(a.generator.lookat[0],a.generator.lookat[1],a.generator.lookat[2])),g},options:{gravity:[0,-50,0],camera:{position:[0,300,400],lookat:[0,0,0],up:[0,0,-1],rotation:[-(Math.PI/8),0,0]},generator:{name:"city",material:{color:11250603,friction:.2,restitution:1}},scene:{items:[{type:"box",pos:[0,150,0],dims:[-1,10,-1],mass:0}]}},init_cam_opts:{position:[0,400,0],lookat:[0,0,0],up:[0,0,-1]}}}}(window,THREE,EXTROVERT),function(a,b,c){c.extrude=function(){var a=null,d=null,e=null;return{init:function(f,g){a=f,d=g,c.create_placement_plane([0,0,200]);var h=new b.MeshLambertMaterial({color:a.generator.material.color});e=a.physics.enabled?Physijs.createMaterial(h,a.generator.material.friction,a.generator.material.restitution):h},transform:function(b){return c.get_position(b,a,d)},rasterize:function(c){var f=d.rasterizer.paint(c,a),g=a.physics.enabled&&a.physics.materials?Physijs.createMaterial(f.mat,.2,1):f.mat;return new b.MeshFaceMaterial([e,e,e,e,g,g])},generate:function(d){var e=this.transform(d),f=this.rasterize(d),g=c.create_object({type:"box",pos:e.pos,dims:[e.width,e.height,e.depth],mat:f,mass:1e3});return a.generator.lookat&&g.lookAt(new b.Vector3(a.generator.lookat[0],a.generator.lookat[1],a.generator.lookat[2])),g},options:{generator:{name:"extrude",material:{color:4456448,friction:.2,restitution:1}},camera:{position:[0,0,800]},block:{depth:100}}}}}(window,THREE,EXTROVERT),function(a,b,c){function d(a,b,d){var e=c.Utils.offset(c.Utils.$(b.src.container)),f=c.Utils.offset(a),g={left:f.left-e.left,top:f.top-e.top},h=c.calc_position(g.left,g.top,d.placement_plane),i=c.calc_position(g.left+a.offsetWidth,g.top+a.offsetHeight,d.placement_plane),j=Math.abs(i.x-h.x),k=b.block.depth,l=Math.abs(h.z-i.z);return{pos:[h.x+j/2,h.y-k/2,h.z+l/2],width:j,depth:l,height:k}}c["float"]=function(){var a=null,e=null;return{init:function(b,d){a=b,e=d;var f=c.Utils.calc_frustum(e.camera);b.scene.items[0].dims[0]=f.farPlane.topRight.x-f.farPlane.topLeft.x,b.scene.items[0].dims[2]=f.farPlane.topRight.y-f.farPlane.botRight.y,c.create_placement_plane([0,200,0],[2e5,1,2e5])},transform:function(b){return d(b,a,e)},rasterize:function(c){var d=e.rasterizer.paint(c,a),f=a.physics.enabled&&a.physics.materials?Physijs.createMaterial(d.mat,.2,1):d.mat;return new b.MeshFaceMaterial([f,f,f,f,f,f])},generate:function(d){var e=this.transform(d),f=this.rasterize(d),g=c.create_object({type:"box",pos:e.pos,dims:[e.width,e.height,e.depth],mat:f,mass:1e3});return a.generator.lookat&&g.lookAt(new b.Vector3(a.generator.lookat[0],a.generator.lookat[1],a.generator.lookat[2])),g},options:{generator:{name:"float",material:{color:4456448,friction:.2,restitution:1}},scene:{items:[{type:"box",pos:[0,150,0],dims:[-1,10,-1],mass:0}]},camera:{position:[0,300,200],rotation:[-(Math.PI/4),0,0]},block:{depth:100},lights:[{type:"point",color:16777215,intensity:1,distance:1e4},{type:"point",color:16777215,intensity:.25,distance:1e3,pos:[0,300,0]}]},init_cam_opts:{position:[0,400,0],lookat:[0,0,0],up:[0,0,-1]}}}}(window,THREE,EXTROVERT),function(a,b,c){c.gallery=function(){var a=null,d=null,e=null;return{init:function(f,g){a=f,d=g,c.create_placement_plane([0,0,200]);var h=new b.MeshLambertMaterial({color:a.generator.material.color});e=a.physics.enabled?Physijs.createMaterial(h,a.generator.material.friction,a.generator.material.restitution):h},transform:function(b){return c.get_position(b,a,d)},rasterize:function(c){var f=d.rasterizer.paint(c,a),g=a.physics.enabled&&a.physics.materials?Physijs.createMaterial(f.mat,.2,1):f.mat;return new b.MeshFaceMaterial([e,e,e,e,g,g])},generate:function(d){var e=this.transform(d),f=this.rasterize(d),g=c.create_object({type:"box",pos:e.pos,dims:[e.width,e.height,e.depth],mat:f,mass:1e3});return a.generator.lookat&&g.lookAt(new b.Vector3(a.generator.lookat[0],a.generator.lookat[1],a.generator.lookat[2])),g},options:{generator:{name:"gallery",material:{color:4456448,friction:.2,restitution:1}},camera:{position:[0,0,3200],far:1e4},lights:[{type:"point",color:16777215,intensity:1,distance:1e4,pos:[0,0,3200]},{type:"ambient",color:3421236}],block:{depth:20}},init_cam_opts:{position:[0,0,800]}}}}(window,THREE,EXTROVERT),function(a,b,c){c.wall=function(){var a=null,d=null,e=null;return{init:function(f,g){a=f,d=g,c.create_placement_plane([0,0,200]);var h=new b.MeshLambertMaterial({color:a.generator.material.color});e=a.physics.enabled?Physijs.createMaterial(h,a.generator.material.friction,a.generator.material.restitution):h},transform:function(b){return c.get_position(b,a,d)},rasterize:function(c){var f=d.rasterizer.paint(c,a),g=a.physics.enabled&&a.physics.materials?Physijs.createMaterial(f.mat,.2,1):f.mat;return new b.MeshFaceMaterial([e,e,e,e,g,g])},generate:function(d){var e=this.transform(d),f=this.rasterize(d),g=c.create_object({type:"box",pos:e.pos,dims:[e.width,e.height,e.depth],mat:f,mass:1e3});return a.generator.lookat&&g.lookAt(new b.Vector3(a.generator.lookat[0],a.generator.lookat[1],a.generator.lookat[2])),g},options:{generator:{name:"wall",material:{color:4456448,friction:.2,restitution:1}},gravity:[0,-200,0],scene:{items:[{type:"box",pos:[0,-2e3,0],dims:[4e3,10,4e3],mass:0}]},camera:{far:2e4,position:[0,-1500,2e3],rotation:[-.25,0,0]},controls:{target:[0,-1500,0]},block:{depth:100}},init_cam_opts:{position:[0,0,800]}}}}(window,THREE,EXTROVERT),function(a,b,c,d){d.paint_html=function(){return{paint:function(){var a=null;return{tex:a,mat:new c.MeshLambertMaterial({map:a,side:c.FrontSide})}}}}}(window,$,THREE,EXTROVERT),function(a,b,c,d){d.paint_img_canvas=function(){return{paint:function(a){var b=a.get(0),d=document.createElement("canvas"),e=d.getContext("2d");return d.width=a.width(),d.height=a.height(),log.msg("Creating texture %d x %d (%d x %d)",b.clientWidth,b.clientHeight,d.width,d.height),e.drawImage(b,0,0,b.clientWidth,b.clientHeight),texture=new c.Texture(d),texture.needsUpdate=!0,{tex:texture,mat:new c.MeshLambertMaterial({map:texture,side:c.FrontSide})}}}}}(window,$,THREE,EXTROVERT),function(a,b,c){c.paint_img=function(){return{paint:function(a){var c=b.ImageUtils.loadTexture(a.src);return{tex:c,mat:new b.MeshLambertMaterial({map:c})}}}}}(window,THREE,EXTROVERT),function(a,b,c,d){d.paint_plain_text=function(){return{paint:function(a,b){var e=d.Utils,f=a.querySelector(b.src.title),g=f.innerHTML,h=a.querySelector(b.src.content),i=h.innerHTML,j=document.createElement("canvas"),k=j.getContext("2d");j.width=a.offsetWidth,j.height=a.offsetHeight;var l=e.get_computed_style(a,"background-color");"rgba(0, 0, 0, 0)"===l&&(l="rgb(0,0,0)"),k.fillStyle=l,k.fillRect(0,0,j.width,j.height);var m=!1;k.font=e.get_computed_style(f,"font"),k.fillStyle=e.get_computed_style(f,"color");var n=24,o=e.wrap_text(k,g,10,10+n,j.width-20,n,!0);k.fillStyle=m?"rgba(0,0,0,0.75)":e.shade_blend(-.25,l),k.fillRect(0,0,j.width,20+o*n),k.fillStyle=e.get_computed_style(f,"color"),e.wrap_text(k,g,10,10+n,j.width-20,n,!1),k.font=e.get_computed_style(h,"font");var p='<div id="_fetchSize" style="display: none;">Sample text</div>';e.$(b.src.container).insertAdjacentHTML("beforeend",p),p=d.Utils.$("#_fetchSize"),p.innerHTML="x";var q=p.offsetHeight,r=i.replace("\n"," ");e.wrap_text(k,r,10,20+o*n+q,j.width-20,q,!1);var s=new c.Texture(j);return s.needsUpdate=!0,{tex:s,mat:new c.MeshLambertMaterial({map:s})}}}}}(window,$,THREE,EXTROVERT),function(a,b,c,d){d.paint_simple_html=function(){return{paint:function(a,b){var e=a.find(b.src.title),f=e.text().trim(),g=document.createElement("canvas"),h=g.getContext("2d");g.width=a.width(),g.height=a.height();var i=a.css("background-color");"rgba(0, 0, 0, 0)"===i&&(i="rgb(0,0,0)"),h.fillStyle=i,h.fillRect(0,0,g.width,g.height);var j=a.children("img");j.length>0&&h.drawImage(j.get(0),0,0,g.width,g.height);var k=e.css("font-size");h.font="Bold "+k+" '"+e.css("font-family")+"'",h.fillStyle=e.css("color"),h.textBaseline="top";var l=24,m=d.Utils.wrap_text(h,f,10,10,g.width-20,l,!0);h.fillStyle=0===j.length?d.Utils.shade_blend(-.25,i):"rgba(0,0,0,0.75)",h.fillRect(0,0,g.width,20+m*l),h.fillStyle=e.css("color"),wrap_text(h,f,10,10,g.width-20,l,!1);var n=new c.Texture(g);return n.needsUpdate=!0,{tex:n,mat:new c.MeshLambertMaterial({map:n})}}}}}(window,$,THREE,EXTROVERT);