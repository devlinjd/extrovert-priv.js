/*! extrovert 19-03-2015 */
var EXTROVERT=function(a,b,c){function d(a){return z.detect_webgl()?(e(a),g(),f(D,B),j(),k(),l(),m(),!0):!1}function e(a){B.generator=a.generator?"string"==typeof a.generator?new EXTROVERT[a.generator]:new EXTROVERT[a.generator.name]:new EXTROVERT.imitate,D=b.extend(!0,{},A,B.generator.options),D=b.extend(!0,D,a),E.msg("Options: %o",D),D.physics.enabled&&(Physijs.scripts.worker=D.physics.physijs.worker,Physijs.scripts.ammo=D.physics.physijs.ammo),B.rasterizer="string"==typeof D.rasterizer?new EXTROVERT["paint_"+D.rasterizer]:D.rasterizer||new EXTROVERT.paint_img,B.log=E}function f(a,b){b.generator.generate(a,b)}function g(){var d=b(D.container),e=d[0].getBoundingClientRect();B.width=e.right-e.left,B.height=e.bottom-e.top,B.renderer=new c.WebGLRenderer,B.renderer.setPixelRatio(a.devicePixelRatio),B.renderer.setSize(B.width,B.height),B.renderer.domElement.setAttribute("tabindex","0"),B.renderer.domElement.style+=" position: relative;",E.msg("Renderer: %o",B.renderer)}function h(a,b){if(b.scene&&b.scene.items)for(var c=0;c<b.scene.items.length;c++){var d=z.create_object(b.scene.items[c]);a.add(d)}}function i(a,b,d,e){return D.physics.enabled&&!e?new Physijs[b+"Mesh"](a,d,0):new c.Mesh(a,d)}function j(){D.physics.enabled&&(B.gravity.set(D.gravity[0],D.gravity[1],D.gravity[2]),B.scene.setGravity(B.gravity),B.scene.addEventListener("update",o))}function k(){B.renderer.domElement.addEventListener("mousedown",u,!1),B.renderer.domElement.addEventListener("mouseup",w,!1),B.renderer.domElement.addEventListener("mousemove",v,!1),a.addEventListener("resize",x,!1)}function l(){B.start_time=B.last_time=Date.now()/1e3}function m(){b(D.container).replaceWith(B.renderer.domElement),D.onload&&D.onload(),n()}function n(){requestAnimationFrame(n),p()}function o(){}function p(){B.scene.simulate();{var a=Date.now()/1e3;a-B.last_time}if(B.last_time=a,!D.move_with_physics){null!==B.selected&&(B.selected.__dirtyPosition=!0);for(var b=0,c=B.card_coll.length;c>b;b++)B.card_coll[b].has_been_touched&&(B.card_coll[b].__dirtyPosition=!0)}B.renderer.clear(),B.renderer.render(B.scene,B.camera)}function q(a){var b=new c.SpotLight(a.color);return b.shadowCameraVisible=!1,b}function r(a,b,c){var d=0>a?-1*a:a,e=Math.round,f=parseInt;if(b.length>7){var g=b.split(","),h=(c?c:0>a?"rgb(0,0,0)":"rgb(255,255,255)").split(","),i=f(g[0].slice(4)),j=f(g[1]),k=f(g[2]);return"rgb("+(e((f(h[0].slice(4))-i)*d)+i)+","+(e((f(h[1])-j)*d)+j)+","+(e((f(h[2])-k)*d)+k)+")"}var g=f(b.slice(1),16),h=f((c?c:0>a?"#000000":"#FFFFFF").slice(1),16),l=g>>16,m=g>>8&255,n=255&g;return"#"+(16777216+65536*(e(((h>>16)-l)*d)+l)+256*(e(((h>>8&255)-m)*d)+m)+(e(((255&h)-n)*d)+n)).toString(16).slice(1)}function s(a,b,c,d,e,f,g){for(var h=b.split("\n"),i=1,j=0;j<h.length;j++){for(var k="",l=h[j].split(" "),m=0;m<l.length;m++){var n=k+l[m]+" ",o=a.measureText(n),p=o.width;p>e?(g||a.fillText(k,c,d),k=l[m]+" ",d+=f,i++):k=n}g||a.fillText(k,c,d),d+=f}return i}function t(a){if(D.physics.enabled){var b=(new c.Matrix4).extractRotation(a.object.matrix),d=a.face.normal.clone().negate().multiplyScalar(3e4).applyMatrix4(b),e=a.point.clone().sub(a.object.position);a.object.applyImpulse(d,e)}}function u(a){a.preventDefault();var b=void 0===a.offsetX?a.layerX:a.offsetX,d=void 0===a.offsetY?a.layerY:a.offsetY;B.mouse=y(b,d,.5,B.mouse),B.raycaster.setFromCamera(B.mouse,B.camera);var e=B.raycaster.intersectObjects(B.card_coll);0!==e.length&&(a.ctrlKey?(B.selected=e[0].object,B.selected.has_been_touched=!0,B.drag_plane.position.copy(B.selected.position),B.offset.copy(e[0].point).sub(B.selected.position),D.physics.enabled?(B.selected.setAngularFactor(C),B.selected.setLinearFactor(C),B.selected.setAngularVelocity(C),B.selected.setLinearVelocity(C)):(B.selected.temp_velocity=(new c.Vector3).copy(B.selected.velocity),B.selected.velocity.set(0,0,0))):t(e[0]))}function v(a){a.preventDefault();var b=void 0===a.offsetX?a.layerX:a.offsetX,c=void 0===a.offsetY?a.layerY:a.offsetY;if(B.mouse=y(b,c,.5,B.mouse),B.selected){B.raycaster.setFromCamera(B.mouse,B.camera);var d=B.raycaster.intersectObject(B.drag_plane);if(D.move_with_physics){var e=d[0].point.sub(B.selected.position);e.z=0,B.selected.setLinearVelocity(e)}else B.selected.position.copy(d[0].point.sub(B.offset)),B.selected.__dirtyPosition=!0}}function w(a){if(a.preventDefault(),B.selected&&D.physics.enabled){if(D.physics.enabled){var b=new c.Vector3(1,1,1);B.selected.setAngularFactor(b),B.selected.setLinearFactor(b),B.selected.__dirtyPosition=!0}else{B.raycaster.setFromCamera(B.mouse,B.camera);var d=B.raycaster.intersectObject(B.drag_plane);B.selected.position.copy(d[0].point.sub(B.offset))}B.selected.updateMatrixWorld(),B.selected.updateMatrix()}B.selected=null}function x(){var a=B.renderer.domElement.parentNode.getBoundingClientRect();B.width=a.right-a.left,B.height=a.bottom-a.top,B.camera.aspect=B.width/B.height,B.camera.updateProjectionMatrix(),B.renderer.setSize(B.width,B.height),E.msg("window_resize( %d, %d a=%s)",B.width,B.height,B.camera.aspect.toString())}function y(a,b,c,d){return d.x=a/B.width*2-1,d.y=2*-(b/B.height)+1,d.z=c,d}var z={};z.init=function(a){return d(a)};var A={src:{selector:"div",title:"h2"},generator:"gallery",rasterizer:"img",container:"#container",gravity:[0,0,0],camera:{fov:35,near:1,far:2e3},physics:{enabled:!0,materials:!1,physijs:{worker:"physijs_worker.min.js",ammo:"ammo.js"}},block:{width:128,height:64,depth:2},move_with_physics:!0,onload:null,onerror:null},B={camera:null,scene:null,renderer:null,raycaster:new c.Raycaster,mouse:new c.Vector2,width:100,height:100,gravity:new c.Vector3(A.gravity[0],A.gravity[1],A.gravity[2]),selected:null,start_time:0,last_time:0,card_coll:[],drag_plane:null,placement_plane:null,offset:new c.Vector3,generator:null},C=new c.Vector3(0,0,0),D=null;z.create_camera=function(a){var b="orthographic"!=a.type?new c.PerspectiveCamera(a.fov,B.width/B.height,a.near,a.far):new c.OrthographicCamera(a.left,a.right,a.top,a.bottom,a.near,a.far);return b.position.set(a.position[0],a.position[1],a.position[2]),B.camera=b,a.up&&b.up.set(a.up[0],a.up[1],a.up[2]),a.lookat&&b.lookAt(new c.Vector3(a.lookat[0],a.lookat[1],a.lookat[2])),b.updateMatrix(),b.updateMatrixWorld(),b.updateProjectionMatrix(),E.msg("Created camera: %o",B.camera),b},z.create_scene=function(a){var b=a.physics.enabled?new Physijs.Scene:new c.Scene;return B.scene=b,E.msg("Created scene: %o",b),h(b,a),b},z.create_object=function(a){var b=null,d=null,e=null,f=a.color||16777215,g=a.opacity||1,h=a.transparent||!0;return"box"===a.type?(d=new c.BoxGeometry(a.dims[0],a.dims[1],a.dims[2]),e=new c.MeshLambertMaterial({color:f,opacity:g,transparent:h}),b=i(d,"Box",e)):"plane"===a.type&&(d=new c.PlaneBufferGeometry(a.dims[0],a.dims[1]),e=new c.MeshBasicMaterial({color:f,opacity:g,transparent:h}),b=i(d,null,e,!0)),a.pos&&b.position.set(a.pos[0],a.pos[1],a.pos[2]),a.visible===!1&&(b.visible=!1),B.log.msg("Created object: %o",b),b},z.fiat_lux=function(a){var d=[],e=null;return b.each(a,function(a,b){if("ambient"===b.type)e=new c.AmbientLight(b.color);else if("point"===b.type)e=new c.PointLight(b.color,b.intensity,b.distance);else{if("spotlight"!==b.type)return;e=q(b)}"ambient"!==b.type&&(b.pos?e.position.set(b.pos[0],b.pos[1],b.pos[2]):e.position.copy(B.camera.position)),B.scene.add(e),d.push(e)}),d},z.generate_texture=function(a){var b=a.find(D.src.title),d=b.text().trim(),e=document.createElement("canvas"),f=e.getContext("2d");e.width=a.width(),e.height=a.height();var g=a.css("background-color");"rgba(0, 0, 0, 0)"===g&&(g="rgb(0,0,0)"),f.fillStyle=g,f.fillRect(0,0,e.width,e.height);var h=a.children("img");h.length>0&&f.drawImage(h.get(0),0,0,e.width,e.height);var i=b.css("font-size");f.font="Bold "+i+" '"+b.css("font-family")+"'",f.fillStyle=b.css("color"),f.textBaseline="top";var j=24,k=s(f,d,10,10,e.width-20,j,!0);f.fillStyle=0===h.length?r(-.25,g):"rgba(0,0,0,0.75)",f.fillRect(0,0,e.width,20+k*j),f.fillStyle=b.css("color"),s(f,d,10,10,e.width-20,j,!1);var l=new c.Texture(e);return l.needsUpdate=!0,{tex:l,mat:new c.MeshLambertMaterial({map:l})}},z.calc_position=function(a,b){B.raycaster.setFromCamera(y(a,b,.5,new c.Vector3),B.camera);var d=B.raycaster.intersectObject(B.placement_plane);return d.length>0?d[0].point:null},z.detect_webgl=function(b){if(a.WebGLRenderingContext){for(var c=document.createElement("canvas"),d=["webgl","experimental-webgl","moz-webgl","webkit-3d"],e=!1,f=0;4>f;f++)try{if(e=c.getContext(d[f]),e&&"function"==typeof e.getParameter)return b?{name:d[f],gl:e}:!0}catch(g){}return!1}return!1},z.calc_frustum=function(a){var b=2*Math.tan(a.fov*Math.PI/180/2)*a.near,d=b*a.aspect,e=2*Math.tan(a.fov*Math.PI/180/2)*a.far,f=e*a.aspect,g=a.position.z-a.near,h=a.position.z-a.far;return{nearPlane:{topLeft:new c.Vector3(-(d/2),b/2,g),topRight:new c.Vector3(d/2,b/2,g),botRight:new c.Vector3(d/2,-(b/2),g),botLeft:new c.Vector3(-(d/2),-(b/2),g)},farPlane:{topLeft:new c.Vector3(-(f/2),e/2,h),topRight:new c.Vector3(f/2,e/2,h),botRight:new c.Vector3(f/2,-(e/2),h),botLeft:new c.Vector3(-(f/2),-(e/2),h)}}};var E=function(){return{msg:function(){var a=Array.prototype.slice.call(arguments);console.log.apply(console,a)},warn:function(){var a=Array.prototype.slice.call(arguments);console.warn.apply(console,a)},error:function(){var a=Array.prototype.slice.call(arguments);console.error.apply(console,a)}}}();return z}(window,$,THREE);!function(a,b,c,d){function e(a,c){d.create_scene(a),d.create_camera(b.extend(!0,{},a.camera,m)),d.fiat_lux(a.lights),f(c),g(a,c),h(a,c),i(a,c);var e=a.camera;c.camera.rotation.set(e.rotation[0],e.rotation[1],e.rotation[2]),c.camera.position.set(e.position[0],e.position[1],e.position[2])}function f(a){return a.drag_plane=d.create_object({type:"plane",dims:[2e3,2e3,8],visible:!1,color:0,opacity:.25,transparent:!0}),a.log.msg("Building drag plane: %o",a.drag_plane),a.drag_plane}function g(a,b){var e=d.calc_frustum(b.camera),f=e.farPlane.topRight.x-e.farPlane.topLeft.x,g=e.farPlane.topRight.y-e.farPlane.botRight.y,h=a.generator.background?c.ImageUtils.loadTexture(a.generator.background):null;h.wrapS=h.wrapT=c.RepeatWrapping,h.repeat.set(100,100);var i=a.physics.enabled?new Physijs.BoxMesh(new c.BoxGeometry(f,10,g),new c.MeshLambertMaterial({color:16777215,map:h}),0):new c.Mesh(new c.BoxGeometry(f,10,g),new c.MeshLambertMaterial({color:3355443,map:h,opacity:1,transparent:!1}));return i.position.y=150,i.receiveShadow=!1,i.updateMatrix(),i.updateMatrixWorld(),b.scene.add(i),b.log.msg("Building ground plane: %o",i),i}function h(a,b){b.placement_plane=a.physics.enabled?new Physijs.BoxMesh(new c.BoxGeometry(2e5,1,2e5),new c.MeshBasicMaterial({color:11215651,opacity:1,transparent:!1}),0):new c.Mesh(new c.BoxGeometry(2e5,1,2e5),new c.MeshBasicMaterial({color:11215651,opacity:1,transparent:!1})),b.placement_plane.visible=!1,b.placement_plane.position.y=200,b.scene.updateMatrix(),b.placement_plane.updateMatrix(),b.placement_plane.updateMatrixWorld(),b.log.msg("Building placement plane: %o",b.placement_plane)}function i(a,d){var e=new c.MeshLambertMaterial({color:a.generator.material.color});d.side_mat=Physijs.createMaterial(e,a.generator.material.friction,a.generator.material.restitution),b(a.src.selector).each(function(b,c){j(b,c,a,d)})}function j(a,d,e,f){var g=k(d,e,f),h=f.rasterizer.paint(b(d),e),i=e.physics.enabled&&e.physics.materials?Physijs.createMaterial(h.mat,.2,1):h.mat;f.side_mat.color=65280;var j=new c.MeshFaceMaterial([f.side_mat,f.side_mat,f.side_mat,f.side_mat,i,i]),l=new c.BoxGeometry(g.width,g.height,g.depth),m=e.physics.enabled?new Physijs.BoxMesh(l,j,1e3):new c.Mesh(l,j);return m.position.copy(g.pos),m.castShadow=m.receiveShadow=!1,e.generator.lookat&&m.lookAt(new c.Vector3(e.generator.lookat[0],e.generator.lookat[1],e.generator.lookat[2])),m.elem=b(d),e.creating&&e.creating(d,m),f.scene.add(m),f.card_coll.push(m),f.log.msg("Created element %d (%f, %f, %f) (size=%f x %f x %f): %o.",a,g.pos.x,g.pos.y,g.pos.z,g.width,g.height,g.depth,m),f.log.msg("Texture = %o",h),e.created&&e.created(d,m),m}function k(a,e,f){var g=b(e.container).offset(),h=b(a).offset(),i={left:h.left-g.left,top:h.top-g.top},j=d.calc_position(i.left,i.top,f.placement_plane),k=d.calc_position(i.left+b(a).width(),i.top+b(a).height(),f.placement_plane),l=Math.abs(k.x-j.x),m=Math.abs(j.z-k.z),n=m;return{pos:new c.Vector3(j.x+l/2,j.y-n/2,j.z+m/2),width:l,depth:m,height:n}}var l={gravity:[0,-50,0],camera:{position:[0,300,400],lookat:[0,0,0],up:[0,0,-1],rotation:[-(Math.PI/8),0,0]},generator:{name:"city",background:"default_background.png",material:{color:11250603,friction:.2,restitution:1}}},m={position:[0,400,0],lookat:[0,0,0],up:[0,0,-1]};d.city=function(){return{generate:function(a,b){a.generator&&"string"!=typeof a.generator||(a.generator=l.generator),e(a,b)},options:l}}}(window,$,THREE,EXTROVERT),function(a,b,c,d){function e(a,b){d.create_scene(a),d.create_camera(a.camera),d.fiat_lux(a.lights),b.drag_plane=d.create_object({type:"plane",dims:[2e3,2e3,8],visible:!1,color:0,opacity:.25,transparent:!0}),b.log.msg("Building drag plane: %o",b.drag_plane);var e=d.calc_frustum(b.camera),g=e.farPlane.topRight.x-e.farPlane.topLeft.x,h=e.farPlane.topRight.y-e.farPlane.botRight.y,i=a.generator.background?c.ImageUtils.loadTexture(a.generator.background):null,j=a.physics.enabled?new Physijs.BoxMesh(new c.BoxGeometry(g,h,10),new c.MeshLambertMaterial({color:16777215,map:i}),0):new c.Mesh(new c.BoxGeometry(g,h,10),new c.MeshLambertMaterial({color:3355443,map:i,opacity:1,transparent:!1}));j.position.z=e.farPlane.topRight.z,j.receiveShadow=!1,j.updateMatrix(),j.updateMatrixWorld(),b.scene.add(j),b.log.msg("Building base plane: %o",j),b.placement_plane=a.physics.enabled?new Physijs.BoxMesh(new c.BoxGeometry(2e5,2e5,1),new c.MeshBasicMaterial({color:11215651,opacity:1,transparent:!1}),0):new c.Mesh(new c.BoxGeometry(2e5,2e5,1),new c.MeshBasicMaterial({color:11215651,opacity:1,transparent:!1})),b.placement_plane.visible=!1,b.placement_plane.position.z=200,b.scene.updateMatrix(),b.placement_plane.updateMatrix(),b.placement_plane.updateMatrixWorld(),b.log.msg("Building placement plane: %o",b.placement_plane),f(a,b)}function f(a,d){var e=new c.MeshLambertMaterial({color:a.generator.material.color});d.side_mat=Physijs.createMaterial(e,a.generator.material.friction,a.generator.material.restitution),b(a.src.selector).each(function(b,c){g(b,c,a,d)})}function g(a,d,e,f){var g=h(d,e,f),i=f.rasterizer.paint(b(d),e),j=e.physics.enabled&&e.physics.materials?Physijs.createMaterial(i.mat,.2,1):i.mat,k=new c.MeshFaceMaterial([f.side_mat,f.side_mat,f.side_mat,f.side_mat,j,j]),l=new c.BoxGeometry(g.width,g.height,g.depth),m=e.physics.enabled?new Physijs.BoxMesh(l,k,1e3):new c.Mesh(l,k);return m.position.copy(g.pos),m.castShadow=m.receiveShadow=!1,e.generator.lookat&&m.lookAt(new c.Vector3(e.generator.lookat[0],e.generator.lookat[1],e.generator.lookat[2])),m.elem=b(d),e.creating&&e.creating(d,m),f.scene.add(m),f.card_coll.push(m),f.log.msg("Created element %d (%f, %f, %f): %o.",a,g.pos.x,g.pos.y,g.pos.z,m),e.created&&e.created(d,m),m}function h(a,e,f){var g=b(e.container).offset(),h=b(a).offset(),i={left:h.left-g.left,top:h.top-g.top},j=d.calc_position(i.left,i.top,f.placement_plane),k=d.calc_position(i.left+b(a).width(),i.top+b(a).height(),f.placement_plane),l=Math.abs(k.x-j.x),m=Math.abs(j.y-k.y);return{pos:new c.Vector3(j.x+l/2,j.y-m/2,j.z-e.block.depth/2),width:l,height:m,depth:e.block.depth}}var i={generator:{name:"extrude",background:"default_background.png",material:{color:4456448,friction:.2,restitution:1}},camera:{fov:35,near:1,far:2e3,position:[0,0,800],rotation:[0,0,0],up:[0,0,-1]}};d.extrude=function(){return{generate:function(a,b){a.generator&&"string"!=typeof a.generator||(a.generator=i.generator),e(a,b)},options:i}}}(window,$,THREE,EXTROVERT),function(a,b,c,d){function e(a,b){d.create_scene(a),d.create_camera(a.camera),d.fiat_lux(a.lights),b.drag_plane=new c.Mesh(new c.PlaneBufferGeometry(2e3,2e3),new c.MeshBasicMaterial({color:0,opacity:.25,transparent:!0})),b.drag_plane.visible=!1,b.log.msg("Building intersection plane: %o",b.drag_plane);var e=d.calc_frustum(b.camera),g=e.farPlane.topRight.x-e.farPlane.topLeft.x,h=e.farPlane.topRight.y-e.farPlane.botRight.y,i=a.generator.background?c.ImageUtils.loadTexture(a.generator.background):null,j=a.physics.enabled?new Physijs.BoxMesh(new c.BoxGeometry(g,10,h),new c.MeshLambertMaterial({color:16777215,map:i}),0):new c.Mesh(new c.BoxGeometry(g,10,h),new c.MeshLambertMaterial({color:3355443,map:i,opacity:1,transparent:!1}));j.position.y=150,j.receiveShadow=!1,j.updateMatrix(),j.updateMatrixWorld(),b.scene.add(j),b.log.msg("Building base plane: %o",j),b.placement_plane=a.physics.enabled?new Physijs.BoxMesh(new c.BoxGeometry(2e5,1,2e5),new c.MeshBasicMaterial({color:11215651,opacity:1,transparent:!1}),0):new c.Mesh(new c.BoxGeometry(2e5,1,2e5),new c.MeshBasicMaterial({color:11215651,opacity:1,transparent:!1})),b.placement_plane.visible=!1,b.placement_plane.position.y=200,b.scene.updateMatrix(),b.placement_plane.updateMatrix(),b.placement_plane.updateMatrixWorld(),b.log.msg("Building placement plane: %o",b.placement_plane),f(a,b),b.camera.rotation.x=-(Math.PI/4),b.camera.position.y=300,b.camera.position.z=200}function f(a,d){var e=new c.MeshLambertMaterial({color:a.generator.material.color});d.side_mat=Physijs.createMaterial(e,a.generator.material.friction,a.generator.material.restitution),b(a.src.selector).each(function(b,c){g(b,c,a,d)})}function g(a,d,e,f){var g=h(d,e,f),i=f.rasterizer.paint(b(d),e),j=e.physics.enabled&&e.physics.materials?Physijs.createMaterial(i.mat,.2,1):i.mat,k=new c.MeshFaceMaterial([j,j,j,j,j,j]),l=new c.BoxGeometry(g.width,g.height,g.depth),m=e.physics.enabled?new Physijs.BoxMesh(l,k,1e3):new c.Mesh(l,k);return m.position.copy(g.pos),m.castShadow=m.receiveShadow=!1,e.generator.lookat&&m.lookAt(new c.Vector3(e.generator.lookat[0],e.generator.lookat[1],e.generator.lookat[2])),m.elem=b(d),e.creating&&e.creating(d,m),f.scene.add(m),f.card_coll.push(m),f.log.msg("Created element %d (%f, %f, %f) (size=%f x %f x %f): %o.",a,g.pos.x,g.pos.y,g.pos.z,g.width,g.height,g.depth,m),f.log.msg("Texture = %o",i),e.created&&e.created(d,m),m}function h(a,e,f){var g=b(e.container).offset(),h=b(a).offset(),i={left:h.left-g.left,top:h.top-g.top},j=d.calc_position(i.left,i.top,f.placement_plane),k=d.calc_position(i.left+b(a).width(),i.top+b(a).height(),f.placement_plane),l=Math.abs(k.x-j.x),m=e.block.depth,n=Math.abs(j.z-k.z);return{pos:new c.Vector3(j.x+l/2,j.y-m/2,j.z+n/2),width:l,depth:n,height:m}}var i={gravity:[0,0,0],camera:{position:[0,400,0],lookat:[0,0,0],up:[0,0,-1]},generator:{name:"float",background:"default_background.png",material:{color:4456448,friction:.2,restitution:1}}};d["float"]=function(){return{generate:function(a,b){a.generator&&"string"!=typeof a.generator||(a.generator=i.generator),e(a,b)},options:i}}}(window,$,THREE,EXTROVERT),function(a,b,c,d){function e(a,b){d.create_scene(a),d.create_camera(a.camera),d.fiat_lux(a.lights),b.drag_plane=new c.Mesh(new c.PlaneBufferGeometry(2e3,2e3,8,8),new c.MeshBasicMaterial({color:0,opacity:.25,transparent:!0})),b.drag_plane.visible=!1,b.log.msg("Building intersection plane: %o",b.drag_plane);var e=d.calc_frustum(b.camera),g=e.farPlane.topRight.x-e.farPlane.topLeft.x,h=e.farPlane.topRight.y-e.farPlane.botRight.y,i=a.generator.background?c.ImageUtils.loadTexture(a.generator.background):null,j=a.physics.enabled?new Physijs.BoxMesh(new c.BoxGeometry(g,h,10),new c.MeshLambertMaterial({color:16777215,map:i}),0):new c.Mesh(new c.BoxGeometry(g,h,10),new c.MeshLambertMaterial({color:3355443,map:i,opacity:1,transparent:!1}));j.position.z=e.farPlane.topRight.z,j.receiveShadow=!1,j.updateMatrix(),j.updateMatrixWorld(),b.scene.add(j),b.log.msg("Building base plane: %o",j),b.placement_plane=a.physics.enabled?new Physijs.BoxMesh(new c.BoxGeometry(2e5,2e5,1),new c.MeshBasicMaterial({color:11215651,opacity:1,transparent:!1}),0):new c.Mesh(new c.BoxGeometry(2e5,2e5,1),new c.MeshBasicMaterial({color:11215651,opacity:1,transparent:!1})),b.placement_plane.visible=!1,b.placement_plane.position.z=200,b.scene.updateMatrix(),b.placement_plane.updateMatrix(),b.placement_plane.updateMatrixWorld(),b.log.msg("Building placement plane: %o",b.placement_plane),f(a,b)}function f(a,d){var e=new c.MeshLambertMaterial({color:a.generator.material.color});d.side_mat=Physijs.createMaterial(e,a.generator.material.friction,a.generator.material.restitution),b(a.src.selector).each(function(b,c){g(b,c,a,d)})}function g(a,d,e,f){var g=h(d,e,f),i=f.rasterizer.paint(b(d),e),j=e.physics.enabled&&e.physics.materials?Physijs.createMaterial(i.mat,.2,1):i.mat,k=new c.MeshFaceMaterial([f.side_mat,f.side_mat,f.side_mat,f.side_mat,j,j]),l=new c.BoxGeometry(g.width,g.height,g.depth),m=e.physics.enabled?new Physijs.BoxMesh(l,k,1e3):new c.Mesh(l,k);return m.position.copy(g.pos),m.castShadow=m.receiveShadow=!1,e.generator.lookat&&m.lookAt(new c.Vector3(e.generator.lookat[0],e.generator.lookat[1],e.generator.lookat[2])),m.elem=b(d),e.creating&&e.creating(d,m),f.scene.add(m),f.card_coll.push(m),f.log.msg("Created element %d (%f, %f, %f): %o.",a,g.pos.x,g.pos.y,g.pos.z,m),e.created&&e.created(d,m),m}function h(a,e,f){var g=b(e.container).offset(),h=b(a).offset(),i={left:h.left-g.left,top:h.top-g.top},j=d.calc_position(i.left,i.top,f.placement_plane),k=d.calc_position(i.left+b(a).width(),i.top+b(a).height(),f.placement_plane),l=Math.abs(k.x-j.x),m=Math.abs(j.y-k.y);return{pos:new c.Vector3(j.x+l/2,j.y-m/2,j.z-e.block.depth/2),width:l,height:m,depth:e.block.depth}}var i={generator:{name:"gallery",background:"default_background.png",material:{color:4456448,friction:.2,restitution:1}},camera:{fov:35,near:1,far:2e3,position:[0,0,800],rotation:[0,0,0],up:[0,0,-1]}};d.gallery=function(){return{generate:function(a,b){a.generator&&"string"!=typeof a.generator||(a.generator=i.generator),e(a,b)},options:i}}}(window,$,THREE,EXTROVERT),function(a,b,c,d){var e={generator:{name:"sample",background:"default_background.png",material:{color:4456448,friction:.2,restitution:1}}};d.sample=function(){return{sample:function(a,c){var d=b.extend(!0,{},e,a);d.generator&&"string"!=typeof d.generator||(d.generator=e.generator),init_objects(d,c)}}}}(window,$,THREE,EXTROVERT),function(a,b,c,d){function e(a,b){d.create_scene(a),d.create_camera(a.camera),d.fiat_lux(a.lights),b.drag_plane=d.create_object({type:"plane",dims:[2e3,2e3,8],visible:!1,color:0,opacity:.25,transparent:!0}),b.log.msg("Building drag plane: %o",b.drag_plane);var e=d.calc_frustum(b.camera),g=e.farPlane.topRight.x-e.farPlane.topLeft.x,h=e.farPlane.topRight.y-e.farPlane.botRight.y,i=a.generator.background?c.ImageUtils.loadTexture(a.generator.background):null,j=a.physics.enabled?new Physijs.BoxMesh(new c.BoxGeometry(g,h,10),new c.MeshLambertMaterial({color:16777215,map:i}),0):new c.Mesh(new c.BoxGeometry(g,h,10),new c.MeshLambertMaterial({color:3355443,map:i,opacity:1,transparent:!1}));j.position.z=e.farPlane.topRight.z,j.receiveShadow=!1,j.updateMatrix(),j.updateMatrixWorld(),b.scene.add(j),b.log.msg("Building base plane: %o",j),b.placement_plane=a.physics.enabled?new Physijs.BoxMesh(new c.BoxGeometry(2e5,2e5,1),new c.MeshBasicMaterial({color:11215651,opacity:1,transparent:!1}),0):new c.Mesh(new c.BoxGeometry(2e5,2e5,1),new c.MeshBasicMaterial({color:11215651,opacity:1,transparent:!1})),b.placement_plane.visible=!1,b.placement_plane.position.z=200,b.scene.updateMatrix(),b.placement_plane.updateMatrix(),b.placement_plane.updateMatrixWorld(),b.log.msg("Building placement plane: %o",b.placement_plane),f(a,b)}function f(a,d){var e=new c.MeshLambertMaterial({color:a.generator.material.color});d.side_mat=Physijs.createMaterial(e,a.generator.material.friction,a.generator.material.restitution),b(a.src.selector).each(function(b,c){g(b,c,a,d)})}function g(a,d,e,f){var g=h(d,e,f),i=f.rasterizer.paint(b(d),e),j=e.physics.enabled&&e.physics.materials?Physijs.createMaterial(i.mat,.2,1):i.mat,k=new c.MeshFaceMaterial([f.side_mat,f.side_mat,f.side_mat,f.side_mat,j,j]),l=new c.BoxGeometry(g.width,g.height,g.depth),m=e.physics.enabled?new Physijs.BoxMesh(l,k,1e3):new c.Mesh(l,k);return m.position.copy(g.pos),m.castShadow=m.receiveShadow=!1,e.generator.lookat&&m.lookAt(new c.Vector3(e.generator.lookat[0],e.generator.lookat[1],e.generator.lookat[2])),m.elem=b(d),e.creating&&e.creating(d,m),f.scene.add(m),f.card_coll.push(m),f.log.msg("Created element %d (%f, %f, %f): %o.",a,g.pos.x,g.pos.y,g.pos.z,m),e.created&&e.created(d,m),m}function h(a,e,f){var g=b(e.container).offset(),h=b(a).offset(),i={left:h.left-g.left,top:h.top-g.top},j=d.calc_position(i.left,i.top,f.placement_plane),k=d.calc_position(i.left+b(a).width(),i.top+b(a).height(),f.placement_plane),l=Math.abs(k.x-j.x),m=Math.abs(j.y-k.y);return{pos:new c.Vector3(j.x+l/2,j.y-m/2,j.z-e.block.depth/2),width:l,height:m,depth:e.block.depth}}var i={generator:{name:"wall",background:"default_background.png",material:{color:4456448,friction:.2,restitution:1}},camera:{fov:35,near:1,far:2e3,position:[0,0,800],rotation:[0,0,0],up:[0,0,-1]}};d.wall=function(){return{generate:function(a,b){a.generator&&"string"!=typeof a.generator||(a.generator=i.generator),e(a,b)},options:i}}}(window,$,THREE,EXTROVERT),function(a,b,c,d){d.paint_html=function(){return{paint:function(){var a=null;return{tex:a,mat:new c.MeshLambertMaterial({map:a,side:c.FrontSide})}}}}}(window,$,THREE,EXTROVERT),function(a,b,c,d){d.paint_img_canvas=function(){return{paint:function(a){var b=a.get(0),d=document.createElement("canvas"),e=d.getContext("2d");return d.width=a.width(),d.height=a.height(),log.msg("Creating texture %d x %d (%d x %d)",b.clientWidth,b.clientHeight,d.width,d.height),e.drawImage(b,0,0,b.clientWidth,b.clientHeight),texture=new c.Texture(d),texture.needsUpdate=!0,{tex:texture,mat:new c.MeshLambertMaterial({map:texture,side:c.FrontSide})}}}}}(window,$,THREE,EXTROVERT),function(a,b,c,d){d.paint_img=function(){return{paint:function(a){var b=a.get(0),d=c.ImageUtils.loadTexture(b.src);return{tex:d,mat:new c.MeshLambertMaterial({map:d,side:c.FrontSide})}}}}}(window,$,THREE,EXTROVERT),function(a,b,c,d){d.paint_simple_html=function(){return{paint:function(){var a=null;return{tex:a,mat:new c.MeshLambertMaterial({map:a,side:c.FrontSide})}}}}}(window,$,THREE,EXTROVERT);