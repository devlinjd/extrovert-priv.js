/*! extrovert 20-03-2015 */
var EXTROVERT=function(a,b,c){function d(a){t.log=EXTROVERT.Utils.log,t.generator=a.generator?"string"==typeof a.generator?new EXTROVERT[a.generator]:new EXTROVERT[a.generator.name]:new EXTROVERT.imitate,u=b.extend(!0,{},s,t.generator.options),u=b.extend(!0,u,a),t.log.msg("Options: %o",u),u.physics.enabled&&(Physijs.scripts.worker=u.physics.physijs.worker,Physijs.scripts.ammo=u.physics.physijs.ammo),t.rasterizer="string"==typeof u.rasterizer?new EXTROVERT["paint_"+u.rasterizer]:u.rasterizer||new EXTROVERT.paint_img}function e(a,b){b.generator.generate(a,b)}function f(a,b){return b.controls=r.create_controls(a.controls),b.controls}function g(){var d=b(u.container),e=d[0].getBoundingClientRect();t.width=e.right-e.left,t.height=e.bottom-e.top,t.renderer=new c.WebGLRenderer,t.renderer.setPixelRatio(a.devicePixelRatio),t.renderer.setSize(t.width,t.height),t.renderer.domElement.setAttribute("tabindex","0"),t.renderer.domElement.style+=" position: relative;",t.log.msg("Renderer: %o",t.renderer)}function h(a,b){if(b.scene&&b.scene.items)for(var c=0;c<b.scene.items.length;c++){var d=r.create_object(b.scene.items[c]);a.add(d)}}function i(a,b,d,e){return u.physics.enabled&&!e?new Physijs[b+"Mesh"](a,d,0):new c.Mesh(a,d)}function j(){u.physics.enabled&&(t.gravity.set(u.gravity[0],u.gravity[1],u.gravity[2]),t.scene.setGravity(t.gravity),t.scene.addEventListener("update",n))}function k(){t.start_time=t.last_time=Date.now()/1e3}function l(){b(u.container).replaceWith(t.renderer.domElement),u.onload&&u.onload(),m()}function m(){requestAnimationFrame(m),o()}function n(){}function o(){t.scene.simulate();{var a=Date.now()/1e3;a-t.last_time}if(t.last_time=a,!u.move_with_physics){null!==t.selected&&(t.selected.__dirtyPosition=!0);for(var b=0,c=t.card_coll.length;c>b;b++)t.card_coll[b].has_been_touched&&(t.card_coll[b].__dirtyPosition=!0)}t.controls&&t.controls.update(t.clock.getDelta()),t.renderer.clear(),t.renderer.render(t.scene,t.camera)}function p(a){var b=new c.SpotLight(a.color);return b.shadowCameraVisible=!1,b}function q(a,b,c,d){return d.x=a/t.width*2-1,d.y=2*-(b/t.height)+1,d.z=c,d}var r={},s={src:{selector:"div",title:"h2"},generator:"gallery",rasterizer:"img",container:"#container",gravity:[0,0,0],camera:{fov:35,near:1,far:2e3},physics:{enabled:!0,materials:!1,physijs:{worker:"physijs_worker.min.js",ammo:"ammo.js"}},block:{width:128,height:64,depth:2},move_with_physics:!0,onload:null,onerror:null},t={camera:null,scene:null,renderer:null,raycaster:new c.Raycaster,mouse:new c.Vector2,width:100,height:100,gravity:new c.Vector3(s.gravity[0],s.gravity[1],s.gravity[2]),selected:null,start_time:0,last_time:0,card_coll:[],drag_plane:null,placement_plane:null,offset:new c.Vector3,generator:null,clock:new c.Clock},u=null;return r.init=function(a){return EXTROVERT.Utils.detect_webgl()?(d(a),g(),e(u,t),f(u,t),j(),k(),l(),!0):!1},r.create_controls=function(a){var b=null;return a&&"trackball"!==a.type?"fly"===a.type:(b=new c.TrackballControls(t.camera),b.rotateSpeed=1,b.zoomSpeed=1.2,b.panSpeed=.8,b.noZoom=!1,b.noPan=!1,b.staticMoving=!0,b.dynamicDampingFactor=.3,b.keys=[65,83,68]),b},r.create_camera=function(a){var b="orthographic"!=a.type?new c.PerspectiveCamera(a.fov,t.width/t.height,a.near,a.far):new c.OrthographicCamera(a.left,a.right,a.top,a.bottom,a.near,a.far);return b.position.set(a.position[0],a.position[1],a.position[2]),t.camera=b,a.up&&b.up.set(a.up[0],a.up[1],a.up[2]),a.lookat&&b.lookAt(new c.Vector3(a.lookat[0],a.lookat[1],a.lookat[2])),b.updateMatrix(),b.updateMatrixWorld(),b.updateProjectionMatrix(),t.log.msg("Created camera: %o",t.camera),b},r.create_scene=function(a){var b=a.physics.enabled?new Physijs.Scene:new c.Scene;return t.scene=b,t.log.msg("Created scene: %o",b),h(b,a),b},r.create_object=function(a){var b=null,d=null,e=null,f=a.color||16777215,g=a.opacity||1,h=a.transparent||!0;return"box"===a.type?(d=new c.BoxGeometry(a.dims[0],a.dims[1],a.dims[2]),e=new c.MeshLambertMaterial({color:f,opacity:g,transparent:h}),b=i(d,"Box",e)):"plane"===a.type&&(d=new c.PlaneBufferGeometry(a.dims[0],a.dims[1]),e=new c.MeshBasicMaterial({color:f,opacity:g,transparent:h}),b=i(d,null,e,!0)),a.pos&&b.position.set(a.pos[0],a.pos[1],a.pos[2]),a.visible===!1&&(b.visible=!1),t.log.msg("Created object: %o",b),b},r.fiat_lux=function(a){var d=[],e=null;return b.each(a,function(a,b){if("ambient"===b.type)e=new c.AmbientLight(b.color);else if("point"===b.type)e=new c.PointLight(b.color,b.intensity,b.distance);else{if("spotlight"!==b.type)return;e=p(b)}"ambient"!==b.type&&(b.pos?e.position.set(b.pos[0],b.pos[1],b.pos[2]):e.position.copy(t.camera.position)),t.scene.add(e),d.push(e)}),d},r.calc_position=function(a,b){t.raycaster.setFromCamera(q(a,b,.5,new c.Vector3),t.camera);var d=t.raycaster.intersectObject(t.placement_plane);return d.length>0?d[0].point:null},r}(window,$,THREE);THREE.FirstPersonControls=function(a,b){function c(a,b){return function(){b.apply(a,arguments)}}this.object=a,this.target=new THREE.Vector3(0,0,0),this.domElement=void 0!==b?b:document,this.enabled=!0,this.movementSpeed=1,this.lookSpeed=.005,this.lookVertical=!0,this.autoForward=!1,this.activeLook=!0,this.heightSpeed=!1,this.heightCoef=1,this.heightMin=0,this.heightMax=1,this.constrainVertical=!1,this.verticalMin=0,this.verticalMax=Math.PI,this.autoSpeedFactor=0,this.mouseX=0,this.mouseY=0,this.lat=0,this.lon=0,this.phi=0,this.theta=0,this.moveForward=!1,this.moveBackward=!1,this.moveLeft=!1,this.moveRight=!1,this.mouseDragOn=!1,this.viewHalfX=0,this.viewHalfY=0,this.domElement!==document&&this.domElement.setAttribute("tabindex",-1),this.handleResize=function(){this.domElement===document?(this.viewHalfX=window.innerWidth/2,this.viewHalfY=window.innerHeight/2):(this.viewHalfX=this.domElement.offsetWidth/2,this.viewHalfY=this.domElement.offsetHeight/2)},this.onMouseDown=function(a){if(this.domElement!==document&&this.domElement.focus(),a.preventDefault(),a.stopPropagation(),this.activeLook)switch(a.button){case 0:this.moveForward=!0;break;case 2:this.moveBackward=!0}this.mouseDragOn=!0},this.onMouseUp=function(a){if(a.preventDefault(),a.stopPropagation(),this.activeLook)switch(a.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}this.mouseDragOn=!1},this.onMouseMove=function(a){this.domElement===document?(this.mouseX=a.pageX-this.viewHalfX,this.mouseY=a.pageY-this.viewHalfY):(this.mouseX=a.pageX-this.domElement.offsetLeft-this.viewHalfX,this.mouseY=a.pageY-this.domElement.offsetTop-this.viewHalfY)},this.onKeyDown=function(a){switch(a.keyCode){case 38:case 87:this.moveForward=!0;break;case 37:case 65:this.moveLeft=!0;break;case 40:case 83:this.moveBackward=!0;break;case 39:case 68:this.moveRight=!0;break;case 82:this.moveUp=!0;break;case 70:this.moveDown=!0}},this.onKeyUp=function(a){switch(a.keyCode){case 38:case 87:this.moveForward=!1;break;case 37:case 65:this.moveLeft=!1;break;case 40:case 83:this.moveBackward=!1;break;case 39:case 68:this.moveRight=!1;break;case 82:this.moveUp=!1;break;case 70:this.moveDown=!1}},this.update=function(a){if(this.enabled!==!1){if(this.heightSpeed){var b=THREE.Math.clamp(this.object.position.y,this.heightMin,this.heightMax),c=b-this.heightMin;this.autoSpeedFactor=a*c*this.heightCoef}else this.autoSpeedFactor=0;var d=a*this.movementSpeed;(this.moveForward||this.autoForward&&!this.moveBackward)&&this.object.translateZ(-(d+this.autoSpeedFactor)),this.moveBackward&&this.object.translateZ(d),this.moveLeft&&this.object.translateX(-d),this.moveRight&&this.object.translateX(d),this.moveUp&&this.object.translateY(d),this.moveDown&&this.object.translateY(-d);var e=a*this.lookSpeed;this.activeLook||(e=0);var f=1;this.constrainVertical&&(f=Math.PI/(this.verticalMax-this.verticalMin)),this.lon+=this.mouseX*e,this.lookVertical&&(this.lat-=this.mouseY*e*f),this.lat=Math.max(-85,Math.min(85,this.lat)),this.phi=THREE.Math.degToRad(90-this.lat),this.theta=THREE.Math.degToRad(this.lon),this.constrainVertical&&(this.phi=THREE.Math.mapLinear(this.phi,0,Math.PI,this.verticalMin,this.verticalMax));var g=this.target,h=this.object.position;g.x=h.x+100*Math.sin(this.phi)*Math.cos(this.theta),g.y=h.y+100*Math.cos(this.phi),g.z=h.z+100*Math.sin(this.phi)*Math.sin(this.theta),this.object.lookAt(g)}},this.domElement.addEventListener("contextmenu",function(a){a.preventDefault()},!1),this.domElement.addEventListener("mousemove",c(this,this.onMouseMove),!1),this.domElement.addEventListener("mousedown",c(this,this.onMouseDown),!1),this.domElement.addEventListener("mouseup",c(this,this.onMouseUp),!1),window.addEventListener("keydown",c(this,this.onKeyDown),!1),window.addEventListener("keyup",c(this,this.onKeyUp),!1),this.handleResize()},THREE.FlyControls=function(a,b){function c(a,b){return function(){b.apply(a,arguments)}}this.object=a,this.domElement=void 0!==b?b:document,b&&this.domElement.setAttribute("tabindex",-1),this.movementSpeed=1,this.rollSpeed=.005,this.dragToLook=!1,this.autoForward=!1,this.tmpQuaternion=new THREE.Quaternion,this.mouseStatus=0,this.moveState={up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0},this.moveVector=new THREE.Vector3(0,0,0),this.rotationVector=new THREE.Vector3(0,0,0),this.handleEvent=function(a){"function"==typeof this[a.type]&&this[a.type](a)},this.keydown=function(a){if(!a.altKey){switch(a.keyCode){case 16:this.movementSpeedMultiplier=.1;break;case 87:this.moveState.forward=1;break;case 83:this.moveState.back=1;break;case 65:this.moveState.left=1;break;case 68:this.moveState.right=1;break;case 82:this.moveState.up=1;break;case 70:this.moveState.down=1;break;case 38:this.moveState.pitchUp=1;break;case 40:this.moveState.pitchDown=1;break;case 37:this.moveState.yawLeft=1;break;case 39:this.moveState.yawRight=1;break;case 81:this.moveState.rollLeft=1;break;case 69:this.moveState.rollRight=1}this.updateMovementVector(),this.updateRotationVector()}},this.keyup=function(a){switch(a.keyCode){case 16:this.movementSpeedMultiplier=1;break;case 87:this.moveState.forward=0;break;case 83:this.moveState.back=0;break;case 65:this.moveState.left=0;break;case 68:this.moveState.right=0;break;case 82:this.moveState.up=0;break;case 70:this.moveState.down=0;break;case 38:this.moveState.pitchUp=0;break;case 40:this.moveState.pitchDown=0;break;case 37:this.moveState.yawLeft=0;break;case 39:this.moveState.yawRight=0;break;case 81:this.moveState.rollLeft=0;break;case 69:this.moveState.rollRight=0}this.updateMovementVector(),this.updateRotationVector()},this.mousedown=function(a){if(this.domElement!==document&&this.domElement.focus(),a.preventDefault(),a.stopPropagation(),this.dragToLook)this.mouseStatus++;else{switch(a.button){case 0:this.moveState.forward=1;break;case 2:this.moveState.back=1}this.updateMovementVector()}},this.mousemove=function(a){if(!this.dragToLook||this.mouseStatus>0){var b=this.getContainerDimensions(),c=b.size[0]/2,d=b.size[1]/2;this.moveState.yawLeft=-(a.pageX-b.offset[0]-c)/c,this.moveState.pitchDown=(a.pageY-b.offset[1]-d)/d,this.updateRotationVector()}},this.mouseup=function(a){if(a.preventDefault(),a.stopPropagation(),this.dragToLook)this.mouseStatus--,this.moveState.yawLeft=this.moveState.pitchDown=0;else{switch(a.button){case 0:this.moveState.forward=0;break;case 2:this.moveState.back=0}this.updateMovementVector()}this.updateRotationVector()},this.update=function(a){var b=a*this.movementSpeed,c=a*this.rollSpeed;this.object.translateX(this.moveVector.x*b),this.object.translateY(this.moveVector.y*b),this.object.translateZ(this.moveVector.z*b),this.tmpQuaternion.set(this.rotationVector.x*c,this.rotationVector.y*c,this.rotationVector.z*c,1).normalize(),this.object.quaternion.multiply(this.tmpQuaternion),this.object.rotation.setFromQuaternion(this.object.quaternion,this.object.rotation.order)},this.updateMovementVector=function(){var a=this.moveState.forward||this.autoForward&&!this.moveState.back?1:0;this.moveVector.x=-this.moveState.left+this.moveState.right,this.moveVector.y=-this.moveState.down+this.moveState.up,this.moveVector.z=-a+this.moveState.back},this.updateRotationVector=function(){this.rotationVector.x=-this.moveState.pitchDown+this.moveState.pitchUp,this.rotationVector.y=-this.moveState.yawRight+this.moveState.yawLeft,this.rotationVector.z=-this.moveState.rollRight+this.moveState.rollLeft},this.getContainerDimensions=function(){return this.domElement!=document?{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,this.domElement.offsetTop]}:{size:[window.innerWidth,window.innerHeight],offset:[0,0]}},this.domElement.addEventListener("contextmenu",function(a){a.preventDefault()},!1),this.domElement.addEventListener("mousemove",c(this,this.mousemove),!1),this.domElement.addEventListener("mousedown",c(this,this.mousedown),!1),this.domElement.addEventListener("mouseup",c(this,this.mouseup),!1),window.addEventListener("keydown",c(this,this.keydown),!1),window.addEventListener("keyup",c(this,this.keyup),!1),this.updateMovementVector(),this.updateRotationVector()},THREE.TrackballControls=function(a,b){function c(a){l.enabled!==!1&&(window.removeEventListener("keydown",c),q=p,p===m.NONE&&(a.keyCode!==l.keys[m.ROTATE]||l.noRotate?a.keyCode!==l.keys[m.ZOOM]||l.noZoom?a.keyCode!==l.keys[m.PAN]||l.noPan||(p=m.PAN):p=m.ZOOM:p=m.ROTATE))}function d(){l.enabled!==!1&&(p=q,window.addEventListener("keydown",c,!1))}function e(a){l.enabled!==!1&&(a.preventDefault(),a.stopPropagation(),p===m.NONE&&(p=a.button),p!==m.ROTATE||l.noRotate?p!==m.ZOOM||l.noZoom?p!==m.PAN||l.noPan||(A.copy(F(a.pageX,a.pageY)),B.copy(A)):(w.copy(F(a.pageX,a.pageY)),x.copy(w)):(t.copy(G(a.pageX,a.pageY)),s.copy(t)),document.addEventListener("mousemove",f,!1),document.addEventListener("mouseup",g,!1),l.dispatchEvent(D))}function f(a){l.enabled!==!1&&(a.preventDefault(),a.stopPropagation(),p!==m.ROTATE||l.noRotate?p!==m.ZOOM||l.noZoom?p!==m.PAN||l.noPan||B.copy(F(a.pageX,a.pageY)):x.copy(F(a.pageX,a.pageY)):(s.copy(t),t.copy(G(a.pageX,a.pageY))))}function g(a){l.enabled!==!1&&(a.preventDefault(),a.stopPropagation(),p=m.NONE,document.removeEventListener("mousemove",f),document.removeEventListener("mouseup",g),l.dispatchEvent(E))}function h(a){if(l.enabled!==!1){a.preventDefault(),a.stopPropagation();var b=0;a.wheelDelta?b=a.wheelDelta/40:a.detail&&(b=-a.detail/3),w.y+=.01*b,l.dispatchEvent(D),l.dispatchEvent(E)}}function i(a){if(l.enabled!==!1){switch(a.touches.length){case 1:p=m.TOUCH_ROTATE,t.copy(G(a.touches[0].pageX,a.touches[0].pageY)),s.copy(t);break;case 2:p=m.TOUCH_ZOOM_PAN;var b=a.touches[0].pageX-a.touches[1].pageX,c=a.touches[0].pageY-a.touches[1].pageY;z=y=Math.sqrt(b*b+c*c);var d=(a.touches[0].pageX+a.touches[1].pageX)/2,e=(a.touches[0].pageY+a.touches[1].pageY)/2;A.copy(F(d,e)),B.copy(A);break;default:p=m.NONE}l.dispatchEvent(D)}}function j(a){if(l.enabled!==!1)switch(a.preventDefault(),a.stopPropagation(),a.touches.length){case 1:s.copy(t),t.copy(G(a.touches[0].pageX,a.touches[0].pageY));break;case 2:var b=a.touches[0].pageX-a.touches[1].pageX,c=a.touches[0].pageY-a.touches[1].pageY;z=Math.sqrt(b*b+c*c);var d=(a.touches[0].pageX+a.touches[1].pageX)/2,e=(a.touches[0].pageY+a.touches[1].pageY)/2;B.copy(F(d,e));break;default:p=m.NONE}}function k(a){if(l.enabled!==!1){switch(a.touches.length){case 1:s.copy(t),t.copy(G(a.touches[0].pageX,a.touches[0].pageY));break;case 2:y=z=0;var b=(a.touches[0].pageX+a.touches[1].pageX)/2,c=(a.touches[0].pageY+a.touches[1].pageY)/2;B.copy(F(b,c)),A.copy(B)}p=m.NONE,l.dispatchEvent(E)}}var l=this,m={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4};this.object=a,this.domElement=void 0!==b?b:document,this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.keys=[65,83,68],this.target=new THREE.Vector3;var n=1e-6,o=new THREE.Vector3,p=m.NONE,q=m.NONE,r=new THREE.Vector3,s=new THREE.Vector2,t=new THREE.Vector2,u=new THREE.Vector3,v=0,w=new THREE.Vector2,x=new THREE.Vector2,y=0,z=0,A=new THREE.Vector2,B=new THREE.Vector2;this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone();var C={type:"change"},D={type:"start"},E={type:"end"};this.handleResize=function(){if(this.domElement===document)this.screen.left=0,this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight;else{var a=this.domElement.getBoundingClientRect(),b=this.domElement.ownerDocument.documentElement;this.screen.left=a.left+window.pageXOffset-b.clientLeft,this.screen.top=a.top+window.pageYOffset-b.clientTop,this.screen.width=a.width,this.screen.height=a.height}},this.handleEvent=function(a){"function"==typeof this[a.type]&&this[a.type](a)};var F=function(){var a=new THREE.Vector2;return function(b,c){return a.set((b-l.screen.left)/l.screen.width,(c-l.screen.top)/l.screen.height),a}}(),G=function(){var a=new THREE.Vector2;return function(b,c){return a.set((b-.5*l.screen.width-l.screen.left)/(.5*l.screen.width),(l.screen.height+2*(l.screen.top-c))/l.screen.width),a}}();this.rotateCamera=function(){var a,b=new THREE.Vector3,c=new THREE.Quaternion,d=new THREE.Vector3,e=new THREE.Vector3,f=new THREE.Vector3,g=new THREE.Vector3;return function(){g.set(t.x-s.x,t.y-s.y,0),a=g.length(),a?(r.copy(l.object.position).sub(l.target),d.copy(r).normalize(),e.copy(l.object.up).normalize(),f.crossVectors(e,d).normalize(),e.setLength(t.y-s.y),f.setLength(t.x-s.x),g.copy(e.add(f)),b.crossVectors(g,r).normalize(),a*=l.rotateSpeed,c.setFromAxisAngle(b,a),r.applyQuaternion(c),l.object.up.applyQuaternion(c),u.copy(b),v=a):!l.staticMoving&&v&&(v*=Math.sqrt(1-l.dynamicDampingFactor),r.copy(l.object.position).sub(l.target),c.setFromAxisAngle(u,v),r.applyQuaternion(c),l.object.up.applyQuaternion(c)),s.copy(t)}}(),this.zoomCamera=function(){var a;p===m.TOUCH_ZOOM_PAN?(a=y/z,y=z,r.multiplyScalar(a)):(a=1+(x.y-w.y)*l.zoomSpeed,1!==a&&a>0&&(r.multiplyScalar(a),l.staticMoving?w.copy(x):w.y+=(x.y-w.y)*this.dynamicDampingFactor))},this.panCamera=function(){var a=new THREE.Vector2,b=new THREE.Vector3,c=new THREE.Vector3;return function(){a.copy(B).sub(A),a.lengthSq()&&(a.multiplyScalar(r.length()*l.panSpeed),c.copy(r).cross(l.object.up).setLength(a.x),c.add(b.copy(l.object.up).setLength(a.y)),l.object.position.add(c),l.target.add(c),l.staticMoving?A.copy(B):A.add(a.subVectors(B,A).multiplyScalar(l.dynamicDampingFactor)))}}(),this.checkDistances=function(){l.noZoom&&l.noPan||(r.lengthSq()>l.maxDistance*l.maxDistance&&l.object.position.addVectors(l.target,r.setLength(l.maxDistance)),r.lengthSq()<l.minDistance*l.minDistance&&l.object.position.addVectors(l.target,r.setLength(l.minDistance)))},this.update=function(){r.subVectors(l.object.position,l.target),l.noRotate||l.rotateCamera(),l.noZoom||l.zoomCamera(),l.noPan||l.panCamera(),l.object.position.addVectors(l.target,r),l.checkDistances(),l.object.lookAt(l.target),o.distanceToSquared(l.object.position)>n&&(l.dispatchEvent(C),o.copy(l.object.position))},this.reset=function(){p=m.NONE,q=m.NONE,l.target.copy(l.target0),l.object.position.copy(l.position0),l.object.up.copy(l.up0),r.subVectors(l.object.position,l.target),l.object.lookAt(l.target),l.dispatchEvent(C),o.copy(l.object.position)},this.domElement.addEventListener("contextmenu",function(a){a.preventDefault()},!1),this.domElement.addEventListener("mousedown",e,!1),this.domElement.addEventListener("mousewheel",h,!1),this.domElement.addEventListener("DOMMouseScroll",h,!1),this.domElement.addEventListener("touchstart",i,!1),this.domElement.addEventListener("touchend",k,!1),this.domElement.addEventListener("touchmove",j,!1),window.addEventListener("keydown",c,!1),window.addEventListener("keyup",d,!1),this.handleResize(),this.update()},THREE.TrackballControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.TrackballControls.prototype.constructor=THREE.TrackballControls,EXTROVERT.Utils=function(a,b,c){var d={};return d.VZERO=new c.Vector3(0,0,0),d.shade_blend=function(a,b,c){var d=0>a?-1*a:a,e=Math.round,f=parseInt;if(b.length>7){var g=b.split(","),h=(c?c:0>a?"rgb(0,0,0)":"rgb(255,255,255)").split(","),i=f(g[0].slice(4)),j=f(g[1]),k=f(g[2]);return"rgb("+(e((f(h[0].slice(4))-i)*d)+i)+","+(e((f(h[1])-j)*d)+j)+","+(e((f(h[2])-k)*d)+k)+")"}var g=f(b.slice(1),16),h=f((c?c:0>a?"#000000":"#FFFFFF").slice(1),16),l=g>>16,m=g>>8&255,n=255&g;return"#"+(16777216+65536*(e(((h>>16)-l)*d)+l)+256*(e(((h>>8&255)-m)*d)+m)+(e(((255&h)-n)*d)+n)).toString(16).slice(1)},d.wrap_text=function(a,b,c,d,e,f,g){for(var h=b.split("\n"),i=1,j=0;j<h.length;j++){for(var k="",l=h[j].split(" "),m=0;m<l.length;m++){var n=k+l[m]+" ",o=a.measureText(n),p=o.width;p>e?(g||a.fillText(k,c,d),k=l[m]+" ",d+=f,i++):k=n}g||a.fillText(k,c,d),d+=f}return i},d.detect_webgl=function(b){if(a.WebGLRenderingContext){for(var c=document.createElement("canvas"),d=["webgl","experimental-webgl","moz-webgl","webkit-3d"],e=!1,f=0;4>f;f++)try{if(e=c.getContext(d[f]),e&&"function"==typeof e.getParameter)return b?{name:d[f],gl:e}:!0}catch(g){}return!1}return!1},d.calc_frustum=function(a){var b=2*Math.tan(a.fov*Math.PI/180/2)*a.near,d=b*a.aspect,e=2*Math.tan(a.fov*Math.PI/180/2)*a.far,f=e*a.aspect,g=a.position.z-a.near,h=a.position.z-a.far;return{nearPlane:{topLeft:new c.Vector3(-(d/2),b/2,g),topRight:new c.Vector3(d/2,b/2,g),botRight:new c.Vector3(d/2,-(b/2),g),botLeft:new c.Vector3(-(d/2),-(b/2),g)},farPlane:{topLeft:new c.Vector3(-(f/2),e/2,h),topRight:new c.Vector3(f/2,e/2,h),botRight:new c.Vector3(f/2,-(e/2),h),botLeft:new c.Vector3(-(f/2),-(e/2),h)}}},d.log=function(){return{msg:function(){var a=Array.prototype.slice.call(arguments);console.log.apply(console,a)},warn:function(){var a=Array.prototype.slice.call(arguments);console.warn.apply(console,a)},error:function(){var a=Array.prototype.slice.call(arguments);console.error.apply(console,a)}}}(),d}(window,$,THREE),function(a,b,c,d){function e(a,c){d.create_scene(a),d.create_camera(b.extend(!0,{},a.camera,m)),d.fiat_lux(a.lights),f(c),g(a,c),h(a,c),i(a,c);var e=a.camera;c.camera.rotation.set(e.rotation[0],e.rotation[1],e.rotation[2]),c.camera.position.set(e.position[0],e.position[1],e.position[2])}function f(a){return a.drag_plane=d.create_object({type:"plane",dims:[2e3,2e3,8],visible:!1,color:0,opacity:.25,transparent:!0}),a.log.msg("Building drag plane: %o",a.drag_plane),a.drag_plane}function g(a,b){var e=d.Utils.calc_frustum(b.camera),f=e.farPlane.topRight.x-e.farPlane.topLeft.x,g=e.farPlane.topRight.y-e.farPlane.botRight.y,h=a.generator.background?c.ImageUtils.loadTexture(a.generator.background):null;h.wrapS=h.wrapT=c.RepeatWrapping,h.repeat.set(100,100);var i=a.physics.enabled?new Physijs.BoxMesh(new c.BoxGeometry(f,10,g),new c.MeshLambertMaterial({color:16777215,map:h}),0):new c.Mesh(new c.BoxGeometry(f,10,g),new c.MeshLambertMaterial({color:3355443,map:h,opacity:1,transparent:!1}));return i.position.y=150,i.receiveShadow=!1,i.updateMatrix(),i.updateMatrixWorld(),b.scene.add(i),b.log.msg("Building ground plane: %o",i),i}function h(a,b){b.placement_plane=a.physics.enabled?new Physijs.BoxMesh(new c.BoxGeometry(2e5,1,2e5),new c.MeshBasicMaterial({color:11215651,opacity:1,transparent:!1}),0):new c.Mesh(new c.BoxGeometry(2e5,1,2e5),new c.MeshBasicMaterial({color:11215651,opacity:1,transparent:!1})),b.placement_plane.visible=!1,b.placement_plane.position.y=200,b.scene.updateMatrix(),b.placement_plane.updateMatrix(),b.placement_plane.updateMatrixWorld(),b.log.msg("Building placement plane: %o",b.placement_plane)}function i(a,d){var e=new c.MeshLambertMaterial({color:a.generator.material.color});d.side_mat=Physijs.createMaterial(e,a.generator.material.friction,a.generator.material.restitution),b(a.src.selector).each(function(b,c){j(b,c,a,d)})}function j(a,d,e,f){var g=k(d,e,f),h=f.rasterizer.paint(b(d),e),i=e.physics.enabled&&e.physics.materials?Physijs.createMaterial(h.mat,.2,1):h.mat;f.side_mat.color=65280;var j=new c.MeshFaceMaterial([f.side_mat,f.side_mat,f.side_mat,f.side_mat,i,i]),l=new c.BoxGeometry(g.width,g.height,g.depth),m=e.physics.enabled?new Physijs.BoxMesh(l,j,1e3):new c.Mesh(l,j);return m.position.copy(g.pos),m.castShadow=m.receiveShadow=!1,e.generator.lookat&&m.lookAt(new c.Vector3(e.generator.lookat[0],e.generator.lookat[1],e.generator.lookat[2])),m.elem=b(d),e.creating&&e.creating(d,m),f.scene.add(m),f.card_coll.push(m),f.log.msg("Created element %d (%f, %f, %f) (size=%f x %f x %f): %o.",a,g.pos.x,g.pos.y,g.pos.z,g.width,g.height,g.depth,m),f.log.msg("Texture = %o",h),e.created&&e.created(d,m),m}function k(a,e,f){var g=b(e.container).offset(),h=b(a).offset(),i={left:h.left-g.left,top:h.top-g.top},j=d.calc_position(i.left,i.top,f.placement_plane),k=d.calc_position(i.left+b(a).width(),i.top+b(a).height(),f.placement_plane),l=Math.abs(k.x-j.x),m=Math.abs(j.z-k.z),n=m;return{pos:new c.Vector3(j.x+l/2,j.y-n/2,j.z+m/2),width:l,depth:m,height:n}}var l={gravity:[0,-50,0],camera:{position:[0,300,400],lookat:[0,0,0],up:[0,0,-1],rotation:[-(Math.PI/8),0,0]},generator:{name:"city",background:"default_background.png",material:{color:11250603,friction:.2,restitution:1}}},m={position:[0,400,0],lookat:[0,0,0],up:[0,0,-1]};d.city=function(){return{generate:function(a,b){a.generator&&"string"!=typeof a.generator||(a.generator=l.generator),e(a,b)},options:l}}}(window,$,THREE,EXTROVERT),function(a,b,c,d){function e(a,b){d.create_scene(a),d.create_camera(a.camera),d.fiat_lux(a.lights),b.drag_plane=d.create_object({type:"plane",dims:[2e3,2e3,8],visible:!1,color:0,opacity:.25,transparent:!0}),b.log.msg("Building drag plane: %o",b.drag_plane);var e=d.Utils.calc_frustum(b.camera),g=e.farPlane.topRight.x-e.farPlane.topLeft.x,h=e.farPlane.topRight.y-e.farPlane.botRight.y,i=a.generator.background?c.ImageUtils.loadTexture(a.generator.background):null,j=a.physics.enabled?new Physijs.BoxMesh(new c.BoxGeometry(g,h,10),new c.MeshLambertMaterial({color:16777215,map:i}),0):new c.Mesh(new c.BoxGeometry(g,h,10),new c.MeshLambertMaterial({color:3355443,map:i,opacity:1,transparent:!1}));j.position.z=e.farPlane.topRight.z,j.receiveShadow=!1,j.updateMatrix(),j.updateMatrixWorld(),b.scene.add(j),b.log.msg("Building base plane: %o",j),b.placement_plane=a.physics.enabled?new Physijs.BoxMesh(new c.BoxGeometry(2e5,2e5,1),new c.MeshBasicMaterial({color:11215651,opacity:1,transparent:!1}),0):new c.Mesh(new c.BoxGeometry(2e5,2e5,1),new c.MeshBasicMaterial({color:11215651,opacity:1,transparent:!1})),b.placement_plane.visible=!1,b.placement_plane.position.z=200,b.scene.updateMatrix(),b.placement_plane.updateMatrix(),b.placement_plane.updateMatrixWorld(),b.log.msg("Building placement plane: %o",b.placement_plane),f(a,b)}function f(a,d){var e=new c.MeshLambertMaterial({color:a.generator.material.color});d.side_mat=Physijs.createMaterial(e,a.generator.material.friction,a.generator.material.restitution),b(a.src.selector).each(function(b,c){g(b,c,a,d)})}function g(a,d,e,f){var g=h(d,e,f),i=f.rasterizer.paint(b(d),e),j=e.physics.enabled&&e.physics.materials?Physijs.createMaterial(i.mat,.2,1):i.mat,k=new c.MeshFaceMaterial([f.side_mat,f.side_mat,f.side_mat,f.side_mat,j,j]),l=new c.BoxGeometry(g.width,g.height,g.depth),m=e.physics.enabled?new Physijs.BoxMesh(l,k,1e3):new c.Mesh(l,k);return m.position.copy(g.pos),m.castShadow=m.receiveShadow=!1,e.generator.lookat&&m.lookAt(new c.Vector3(e.generator.lookat[0],e.generator.lookat[1],e.generator.lookat[2])),m.elem=b(d),e.creating&&e.creating(d,m),f.scene.add(m),f.card_coll.push(m),f.log.msg("Created element %d (%f, %f, %f): %o.",a,g.pos.x,g.pos.y,g.pos.z,m),e.created&&e.created(d,m),m}function h(a,e,f){var g=b(e.container).offset(),h=b(a).offset(),i={left:h.left-g.left,top:h.top-g.top},j=d.calc_position(i.left,i.top,f.placement_plane),k=d.calc_position(i.left+b(a).width(),i.top+b(a).height(),f.placement_plane),l=Math.abs(k.x-j.x),m=Math.abs(j.y-k.y);return{pos:new c.Vector3(j.x+l/2,j.y-m/2,j.z-e.block.depth/2),width:l,height:m,depth:e.block.depth}}var i={generator:{name:"extrude",background:"default_background.png",material:{color:4456448,friction:.2,restitution:1}},camera:{fov:35,near:1,far:2e3,position:[0,0,800],rotation:[0,0,0],up:[0,0,-1]}};d.extrude=function(){return{generate:function(a,b){a.generator&&"string"!=typeof a.generator||(a.generator=i.generator),e(a,b)},options:i}}}(window,$,THREE,EXTROVERT),function(a,b,c,d){function e(a,b){d.create_scene(a),d.create_camera(a.camera),d.fiat_lux(a.lights),b.drag_plane=new c.Mesh(new c.PlaneBufferGeometry(2e3,2e3),new c.MeshBasicMaterial({color:0,opacity:.25,transparent:!0})),b.drag_plane.visible=!1,b.log.msg("Building intersection plane: %o",b.drag_plane);var e=d.Utils.calc_frustum(b.camera),g=e.farPlane.topRight.x-e.farPlane.topLeft.x,h=e.farPlane.topRight.y-e.farPlane.botRight.y,i=a.generator.background?c.ImageUtils.loadTexture(a.generator.background):null,j=a.physics.enabled?new Physijs.BoxMesh(new c.BoxGeometry(g,10,h),new c.MeshLambertMaterial({color:16777215,map:i}),0):new c.Mesh(new c.BoxGeometry(g,10,h),new c.MeshLambertMaterial({color:3355443,map:i,opacity:1,transparent:!1}));j.position.y=150,j.receiveShadow=!1,j.updateMatrix(),j.updateMatrixWorld(),b.scene.add(j),b.log.msg("Building base plane: %o",j),b.placement_plane=a.physics.enabled?new Physijs.BoxMesh(new c.BoxGeometry(2e5,1,2e5),new c.MeshBasicMaterial({color:11215651,opacity:1,transparent:!1}),0):new c.Mesh(new c.BoxGeometry(2e5,1,2e5),new c.MeshBasicMaterial({color:11215651,opacity:1,transparent:!1})),b.placement_plane.visible=!1,b.placement_plane.position.y=200,b.scene.updateMatrix(),b.placement_plane.updateMatrix(),b.placement_plane.updateMatrixWorld(),b.log.msg("Building placement plane: %o",b.placement_plane),f(a,b),b.camera.rotation.x=-(Math.PI/4),b.camera.position.y=300,b.camera.position.z=200}function f(a,d){var e=new c.MeshLambertMaterial({color:a.generator.material.color});d.side_mat=Physijs.createMaterial(e,a.generator.material.friction,a.generator.material.restitution),b(a.src.selector).each(function(b,c){g(b,c,a,d)})}function g(a,d,e,f){var g=h(d,e,f),i=f.rasterizer.paint(b(d),e),j=e.physics.enabled&&e.physics.materials?Physijs.createMaterial(i.mat,.2,1):i.mat,k=new c.MeshFaceMaterial([j,j,j,j,j,j]),l=new c.BoxGeometry(g.width,g.height,g.depth),m=e.physics.enabled?new Physijs.BoxMesh(l,k,1e3):new c.Mesh(l,k);return m.position.copy(g.pos),m.castShadow=m.receiveShadow=!1,e.generator.lookat&&m.lookAt(new c.Vector3(e.generator.lookat[0],e.generator.lookat[1],e.generator.lookat[2])),m.elem=b(d),e.creating&&e.creating(d,m),f.scene.add(m),f.card_coll.push(m),f.log.msg("Created element %d (%f, %f, %f) (size=%f x %f x %f): %o.",a,g.pos.x,g.pos.y,g.pos.z,g.width,g.height,g.depth,m),f.log.msg("Texture = %o",i),e.created&&e.created(d,m),m}function h(a,e,f){var g=b(e.container).offset(),h=b(a).offset(),i={left:h.left-g.left,top:h.top-g.top},j=d.calc_position(i.left,i.top,f.placement_plane),k=d.calc_position(i.left+b(a).width(),i.top+b(a).height(),f.placement_plane),l=Math.abs(k.x-j.x),m=e.block.depth,n=Math.abs(j.z-k.z);return{pos:new c.Vector3(j.x+l/2,j.y-m/2,j.z+n/2),width:l,depth:n,height:m}}var i={gravity:[0,0,0],camera:{position:[0,400,0],lookat:[0,0,0],up:[0,0,-1]},generator:{name:"float",background:"default_background.png",material:{color:4456448,friction:.2,restitution:1}}};d["float"]=function(){return{generate:function(a,b){a.generator&&"string"!=typeof a.generator||(a.generator=i.generator),e(a,b)},options:i}}}(window,$,THREE,EXTROVERT),function(a,b,c,d){function e(a,b){d.create_scene(a),d.create_camera(a.camera),d.fiat_lux(a.lights),b.drag_plane=new c.Mesh(new c.PlaneBufferGeometry(2e3,2e3,8,8),new c.MeshBasicMaterial({color:0,opacity:.25,transparent:!0})),b.drag_plane.visible=!1,b.log.msg("Building intersection plane: %o",b.drag_plane);var e=d.Utils.calc_frustum(b.camera),g=e.farPlane.topRight.x-e.farPlane.topLeft.x,h=e.farPlane.topRight.y-e.farPlane.botRight.y,i=a.generator.background?c.ImageUtils.loadTexture(a.generator.background):null,j=a.physics.enabled?new Physijs.BoxMesh(new c.BoxGeometry(g,h,10),new c.MeshLambertMaterial({
color:16777215,map:i}),0):new c.Mesh(new c.BoxGeometry(g,h,10),new c.MeshLambertMaterial({color:3355443,map:i,opacity:1,transparent:!1}));j.position.z=e.farPlane.topRight.z,j.receiveShadow=!1,j.updateMatrix(),j.updateMatrixWorld(),b.scene.add(j),b.log.msg("Building base plane: %o",j),b.placement_plane=a.physics.enabled?new Physijs.BoxMesh(new c.BoxGeometry(2e5,2e5,1),new c.MeshBasicMaterial({color:11215651,opacity:1,transparent:!1}),0):new c.Mesh(new c.BoxGeometry(2e5,2e5,1),new c.MeshBasicMaterial({color:11215651,opacity:1,transparent:!1})),b.placement_plane.visible=!1,b.placement_plane.position.z=200,b.scene.updateMatrix(),b.placement_plane.updateMatrix(),b.placement_plane.updateMatrixWorld(),b.log.msg("Building placement plane: %o",b.placement_plane),f(a,b)}function f(a,d){var e=new c.MeshLambertMaterial({color:a.generator.material.color});d.side_mat=Physijs.createMaterial(e,a.generator.material.friction,a.generator.material.restitution),b(a.src.selector).each(function(b,c){g(b,c,a,d)})}function g(a,d,e,f){var g=h(d,e,f),i=f.rasterizer.paint(b(d),e),j=e.physics.enabled&&e.physics.materials?Physijs.createMaterial(i.mat,.2,1):i.mat,k=new c.MeshFaceMaterial([f.side_mat,f.side_mat,f.side_mat,f.side_mat,j,j]),l=new c.BoxGeometry(g.width,g.height,g.depth),m=e.physics.enabled?new Physijs.BoxMesh(l,k,1e3):new c.Mesh(l,k);return m.position.copy(g.pos),m.castShadow=m.receiveShadow=!1,e.generator.lookat&&m.lookAt(new c.Vector3(e.generator.lookat[0],e.generator.lookat[1],e.generator.lookat[2])),m.elem=b(d),e.creating&&e.creating(d,m),f.scene.add(m),f.card_coll.push(m),f.log.msg("Created element %d (%f, %f, %f): %o.",a,g.pos.x,g.pos.y,g.pos.z,m),e.created&&e.created(d,m),m}function h(a,e,f){var g=b(e.container).offset(),h=b(a).offset(),i={left:h.left-g.left,top:h.top-g.top},j=d.calc_position(i.left,i.top,f.placement_plane),k=d.calc_position(i.left+b(a).width(),i.top+b(a).height(),f.placement_plane),l=Math.abs(k.x-j.x),m=Math.abs(j.y-k.y);return{pos:new c.Vector3(j.x+l/2,j.y-m/2,j.z-e.block.depth/2),width:l,height:m,depth:e.block.depth}}var i={generator:{name:"gallery",background:"default_background.png",material:{color:4456448,friction:.2,restitution:1}},camera:{fov:35,near:1,far:2e3,position:[0,0,800],rotation:[0,0,0]}};d.gallery=function(){return{generate:function(a,b){a.generator&&"string"!=typeof a.generator||(a.generator=i.generator),e(a,b)},options:i}}}(window,$,THREE,EXTROVERT),function(a,b,c,d){var e={generator:{name:"sample",background:"default_background.png",material:{color:4456448,friction:.2,restitution:1}}};d.sample=function(){return{sample:function(a,c){var d=b.extend(!0,{},e,a);d.generator&&"string"!=typeof d.generator||(d.generator=e.generator),init_objects(d,c)}}}}(window,$,THREE,EXTROVERT),function(a,b,c,d){function e(a,e){d.create_scene(a),d.create_camera(b.extend(!0,{},a.camera,j)),d.fiat_lux(a.lights),e.drag_plane=d.create_object({type:"plane",dims:[2e3,2e3,8],visible:!1,color:0,opacity:.25,transparent:!0}),e.log.msg("Building drag plane: %o",e.drag_plane),e.placement_plane=a.physics.enabled?new Physijs.BoxMesh(new c.BoxGeometry(2e5,2e5,1),new c.MeshBasicMaterial({color:11215651,opacity:1,transparent:!1}),0):new c.Mesh(new c.BoxGeometry(2e5,2e5,1),new c.MeshBasicMaterial({color:11215651,opacity:1,transparent:!1})),e.placement_plane.visible=!1,e.placement_plane.position.z=200,e.scene.updateMatrix(),e.placement_plane.updateMatrix(),e.placement_plane.updateMatrixWorld(),e.log.msg("Building placement plane: %o",e.placement_plane),f(a,e);var g=a.camera;g.rotation&&e.camera.rotation.set(g.rotation[0],g.rotation[1],g.rotation[2]),g.position&&e.camera.position.set(g.position[0],g.position[1],g.position[2])}function f(a,d){var e=new c.MeshLambertMaterial({color:a.generator.material.color});d.side_mat=Physijs.createMaterial(e,a.generator.material.friction,a.generator.material.restitution),b(a.src.selector).each(function(b,c){g(b,c,a,d)})}function g(a,d,e,f){var g=h(d,e,f),i=f.rasterizer.paint(b(d),e),j=e.physics.enabled&&e.physics.materials?Physijs.createMaterial(i.mat,.2,1):i.mat,k=new c.MeshFaceMaterial([f.side_mat,f.side_mat,f.side_mat,f.side_mat,j,j]),l=new c.BoxGeometry(g.width,g.height,g.depth),m=e.physics.enabled?new Physijs.BoxMesh(l,k,1e3):new c.Mesh(l,k);return m.position.copy(g.pos),m.castShadow=m.receiveShadow=!1,e.generator.lookat&&m.lookAt(new c.Vector3(e.generator.lookat[0],e.generator.lookat[1],e.generator.lookat[2])),m.elem=b(d),e.creating&&e.creating(d,m),f.scene.add(m),f.card_coll.push(m),f.log.msg("Created element %d (%f, %f, %f): %o.",a,g.pos.x,g.pos.y,g.pos.z,m),e.created&&e.created(d,m),m}function h(a,e,f){var g=b(e.container).offset(),h=b(a).offset(),i={left:h.left-g.left,top:h.top-g.top},j=d.calc_position(i.left,i.top,f.placement_plane),k=d.calc_position(i.left+b(a).width(),i.top+b(a).height(),f.placement_plane),l=Math.abs(k.x-j.x),m=Math.abs(j.y-k.y);return{pos:new c.Vector3(j.x+l/2,j.y-m/2,j.z-e.block.depth/2),width:l,height:m,depth:e.block.depth}}var i={generator:{name:"wall",background:"default_background.png",material:{color:4456448,friction:.2,restitution:1}},gravity:[0,-200,0],scene:{items:[{type:"box",pos:[0,-2e3,0],dims:[4e3,10,4e3]}]},camera:{far:2e4,position:[0,0,4400],rotation:[-.25,0,0]},block:{depth:100}},j={position:[0,0,800]};d.wall=function(){return{generate:function(a,b){a.generator&&"string"!=typeof a.generator||(a.generator=i.generator),e(a,b)},options:i}}}(window,$,THREE,EXTROVERT),function(a,b,c,d){d.paint_html=function(){return{paint:function(){var a=null;return{tex:a,mat:new c.MeshLambertMaterial({map:a,side:c.FrontSide})}}}}}(window,$,THREE,EXTROVERT),function(a,b,c,d){d.paint_img_canvas=function(){return{paint:function(a){var b=a.get(0),d=document.createElement("canvas"),e=d.getContext("2d");return d.width=a.width(),d.height=a.height(),log.msg("Creating texture %d x %d (%d x %d)",b.clientWidth,b.clientHeight,d.width,d.height),e.drawImage(b,0,0,b.clientWidth,b.clientHeight),texture=new c.Texture(d),texture.needsUpdate=!0,{tex:texture,mat:new c.MeshLambertMaterial({map:texture,side:c.FrontSide})}}}}}(window,$,THREE,EXTROVERT),function(a,b,c,d){d.paint_img=function(){return{paint:function(a){var b=a.get(0),d=c.ImageUtils.loadTexture(b.src);return{tex:d,mat:new c.MeshLambertMaterial({map:d,side:c.FrontSide})}}}}}(window,$,THREE,EXTROVERT),function(a,b,c,d){d.paint_simple_html=function(){return{paint:function(a,b){var e=a.find(b.src.title),f=e.text().trim(),g=document.createElement("canvas"),h=g.getContext("2d");g.width=a.width(),g.height=a.height();var i=a.css("background-color");"rgba(0, 0, 0, 0)"===i&&(i="rgb(0,0,0)"),h.fillStyle=i,h.fillRect(0,0,g.width,g.height);var j=a.children("img");j.length>0&&h.drawImage(j.get(0),0,0,g.width,g.height);var k=e.css("font-size");h.font="Bold "+k+" '"+e.css("font-family")+"'",h.fillStyle=e.css("color"),h.textBaseline="top";var l=24,m=d.Utils.wrap_text(h,f,10,10,g.width-20,l,!0);h.fillStyle=0===j.length?d.Utils.shade_blend(-.25,i):"rgba(0,0,0,0.75)",h.fillRect(0,0,g.width,20+m*l),h.fillStyle=e.css("color"),wrap_text(h,f,10,10,g.width-20,l,!1);var n=new c.Texture(g);return n.needsUpdate=!0,{tex:n,mat:new c.MeshLambertMaterial({map:n})}}}}}(window,$,THREE,EXTROVERT);